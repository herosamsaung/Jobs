<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم وظائف رؤيا</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://www2.0zz0.com/2025/10/15/20/337819623.png">
  <style>
    :root {
      --purple: #4b1979;
      --purple-grad: linear-gradient(90deg, #7f38c0 0%, #4b1979 100%);
      --purple-btn: linear-gradient(90deg, #a259c4 0%, #7f38c0 100%);
      --white: #fff;
      --shadow: 0 8px 32px #4b197914;
      --gold: #b88f27;
      --green: #39bb6c;
      --danger: #e6415d;
      --gray: #f7f4fb;
    }
    body {
      margin: 0;
      font-family: 'Cairo', Arial, sans-serif;
      background: #f7f4fb;
      color: var(--purple);
      min-height: 100vh;
    }
    .header {
      background: var(--purple);
      color: var(--white);
      text-align: center;
      padding: 34px 10px 16px;
      position: relative;
    }
    .header img {
      width: 60px; height: 60px;
      border-radius: 15px;
      background: var(--white);
      border: 3px solid #fff;
      margin-bottom: 10px;
      box-shadow: var(--shadow);
    }
    .header h1 {
      font-size: 2rem;
      font-weight: 900;
      margin: 8px 0;
      letter-spacing: .5px;
    }
    .logout-btn {
      position: absolute;
      left: 18px; top: 18px;
      background: #fff;
      color: var(--purple);
      font-weight: 700;
      padding: 7px 22px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 12px #7f38c034;
      transition: background .2s;
    }
    .logout-btn:hover { background: #f2e7fa;}
    .tabs {
      display: flex;
      justify-content: center;
      margin: 0;
      background: #fff;
      border-radius: 0 0 24px 24px;
      box-shadow: 0 1px 8px #4b197918;
      position: relative;
      top: -8px;
      z-index: 3;
    }
    .tab-btn {
      background: none;
      border: none;
      padding: 19px 38px 10px 38px;
      font-size: 1.11rem;
      font-weight: 700;
      color: #7f38c0;
      cursor: pointer;
      border-bottom: 4px solid transparent;
      transition: color .2s, border .2s;
      outline: none;
    }
    .tab-btn.active {
      color: var(--purple);
      border-bottom: 4px solid var(--purple);
    }
    .container {
      max-width: 1150px;
      margin: 34px auto 30px auto;
      background: #fff;
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 34px 18px 44px 18px;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .add-jobs-btn {
      background: var(--green);
      color: #fff;
      border: none;
      padding: 9px 22px;
      border-radius: 13px;
      font-size: 1.05rem;
      font-weight: 800;
      box-shadow: 0 2px 12px #43b96833;
      cursor: pointer;
      margin-bottom: 13px;
      margin-top: 6px;
      transition: background .2s;
    }
    .add-jobs-btn:active {background: #36994a;}
    .remove-jobs-btn {
      background: var(--danger);
      color: #fff;
      border: none;
      padding: 9px 22px;
      border-radius: 13px;
      font-size: 1.05rem;
      font-weight: 800;
      box-shadow: 0 2px 12px #e6415d33;
      cursor: pointer;
      margin-bottom: 13px;
      margin-right: 13px;
      margin-top: 6px;
      transition: background .2s;
    }
    .remove-jobs-btn:active {background: #b21f3d;}
    .whatsapp-edit {
      display: flex; align-items: center; gap: 7px; margin-bottom: 18px;
    }
    .whatsapp-edit input {
      padding: 7px 12px;
      border-radius: 9px;
      border: 1.2px solid #d0b8e4;
      font-size: 1.09rem;
    }
    .whatsapp-edit button {
      background: var(--purple-btn);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 7px 20px;
      font-size: 1.08rem;
      font-weight: 700;
      cursor: pointer;
      transition: background .2s;
    }
    .whatsapp-edit button:active {background: var(--purple);}
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 30px;
      background: #fff;
    }
    th, td {
      border: 1px solid #eee;
      padding: 10px 6px;
      text-align: right;
      font-size: 1.01rem;
    }
    th {
      background: var(--purple);
      color: #fff;
      font-weight: bold;
    }
    tr:nth-child(even) { background: #f2e7fa;}
    .actions button {
      background: var(--purple-btn);
      color: #fff;
      border: none;
      padding: 6px 18px;
      border-radius: 7px;
      font-size: .97rem;
      cursor: pointer;
      transition: background .2s;
      margin-left: 8px;
    }
    .actions button.delete {
      background: #e6415d;
    }
    .actions button:active { opacity: .8; }
    .add-job-form input, .add-job-form textarea, .add-job-form select {
      width: 100%;
      padding: 10px 11px;
      margin-bottom: 14px;
      background: #fff;
      border: 1.5px solid #d0b8e4;
      border-radius: 9px;
      font-size: 1.08rem;
      font-family: inherit;
      outline: none;
      transition: border .2s;
      box-sizing: border-box;
    }
    .add-job-form input[type="file"] { padding: 0; }
    .add-job-form input:focus, .add-job-form textarea:focus, .add-job-form select:focus {
      border-color: #7f38c0;
    }
    .add-job-form button {
      background: var(--purple-btn);
      color: #fff;
      border: none;
      padding: 11px 0;
      width: 100%;
      border-radius: 14px;
      font-size: 1.08rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 7px;
      box-shadow: 0 3px 16px #7f38c034;
      transition: background .2s;
    }
    .add-job-form button:active { background: var(--purple);}
    .job-emoji-btn {
      font-size: 1.65rem;
      margin-left: 6px;
      cursor: pointer;
      background: none;
      border: none;
      transition: transform .2s;
    }
    .job-emoji-btn:hover { transform: scale(1.23);}
    .emoji-list {
      position: absolute;
      background: #fff;
      border: 1px solid #b88f27;
      border-radius: 9px;
      padding: 6px 10px;
      z-index: 999;
      display: flex;
      gap: 7px;
      flex-wrap: wrap;
      font-size: 1.5rem;
      box-shadow: 0 2px 12px #b88f2722;
      top: 44px; right: 0;
    }
    .emoji-list span { cursor:pointer; transition: background .2s; border-radius:6px; }
    .emoji-list span:hover { background: #f2e7fa;}
    .job-img-preview { width: 48px; height: 48px; object-fit: cover; border-radius: 8px; margin-bottom: 6px; display:block;}
    /* المشرفين */
    .admin-table {margin-top:12px;}
    .admin-table th, .admin-table td {font-size:1.04rem;}
    .admin-table th {background: #39bb6c;}
    .notify {
      position: fixed;
      top: 20px;
      right: 50%;
      transform: translateX(50%);
      background: var(--purple-btn);
      color: #fff;
      padding: 16px 32px;
      border-radius: 18px;
      font-size: 1.13rem;
      font-weight: 700;
      box-shadow: 0 2px 16px #7f38c044;
      z-index: 99999;
      display: none;
      animation: fadeIn .5s;
    }
    @keyframes fadeIn {
      from { opacity:0; top:10px;}
      to { opacity:1; top:20px;}
    }
    /* شاشة تسجيل الدخول */
    .login-backdrop {
      display: flex;
      position: fixed;
      z-index: 99999;
      top:0; left:0; width:100vw; height:100vh;
      background: #2a003b90;
      justify-content: center;
      align-items: center;
    }
    .login-modal {
      background: #fff;
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 32px 24px 24px 24px;
      max-width: 340px;
      width: 95vw;
      text-align: center;
      position: relative;
    }
    .login-modal h2 { color: var(--purple);}
    .login-modal input {
      width: 100%; padding: 11px 9px; margin-bottom: 12px;
      border-radius: 8px; border: 1.3px solid #d0b8e4;
      font-size: 1.1rem;
    }
    .login-modal button {
      background: var(--purple-btn); color:#fff;
      border:none; width:100%; border-radius: 10px;
      padding: 10px 0; font-size: 1.08rem; font-weight:700;
      margin-top: 5px;
    }
    .login-error { color: var(--danger); font-weight: bold; margin:7px 0;}
    @media (max-width:900px) {.container {padding:13px;}}
    @media (max-width:600px) {
      .header h1 { font-size: 1.18rem;}
      .container { padding: 8px;}
      .tab-btn { padding: 14px 12px 8px 12px; font-size:.98rem;}
      th,td { font-size: .93rem;}
    }
    ::-webkit-scrollbar { width: 9px;}
    ::-webkit-scrollbar-thumb { background: #7f38c034; border-radius: 6px;}
    ::selection { background: #7f38c022; }
  </style>
</head>
<body>
  <div id="loginBackdrop" class="login-backdrop">
    <div class="login-modal">
      <h2>دخول المشرف</h2>
      <input type="text" id="adminUser" placeholder="اسم المستخدم" autocomplete="off">
      <input type="password" id="adminPass" placeholder="كلمة المرور">
      <button onclick="loginAdmin()">دخول</button>
      <div class="login-error" id="loginError"></div>
    </div>
  </div>
  <div class="header" id="mainHeader" style="display:none;">
    <img src="https://www2.0zz0.com/2025/10/15/20/337819623.png" alt="شعار رؤيا">
    <h1>لوحة تحكم وظائف رؤيا</h1>
    <button class="logout-btn" onclick="logout()">تسجيل الخروج</button>
  </div>
  <div class="tabs" id="mainTabs" style="display:none;">
    <button class="tab-btn active" onclick="showTab('jobsTab')">الوظائف</button>
    <button class="tab-btn" onclick="showTab('usersTab')">المستخدمون</button>
    <button class="tab-btn" id="adminsBtn" style="display:none;" onclick="showTab('adminsTab')">المشرفون</button>
  </div>
  <div class="container" id="mainContainer" style="display:none;">
    <!-- الوظائف -->
    <div id="jobsTab" class="tab-content active">
      <div class="whatsapp-edit">
        <label>رقم واتساب للتواصل:&nbsp;</label>
        <input type="text" id="whatsappInput" placeholder="مثال: 0790000000" maxlength="14">
        <button onclick="saveWhatsapp()">حفظ</button>
      </div>
      <button class="add-jobs-btn" onclick="addSampleJobs()">إضافة وظائف جاهزة</button>
      <input type="number" id="addJobsCount" value="100" min="1" max="500" style="width:80px;margin-left:12px;">
      <button class="remove-jobs-btn" onclick="removeJobs()">حذف وظائف جماعي</button>
      <input type="number" id="removeJobsCount" value="10" min="1" max="500" style="width:80px;">
      <form class="add-job-form" id="jobForm" enctype="multipart/form-data">
        <input required type="text" id="jobTitle" placeholder="المسمى الوظيفي">
        <span style="position:relative;display:inline-block;">
          <button type="button" class="job-emoji-btn" id="emojiBtn" onclick="toggleEmojiList()">💼</button>
          <div id="emojiList" class="emoji-list" style="display:none;"></div>
        </span>
        <input type="number" id="jobSalary" placeholder="الراتب (دينار)" min="300" max="4000">
        <input type="number" id="jobHours" placeholder="عدد ساعات العمل" min="5" max="12">
        <select required id="jobLocation">
          <option value="">المحافظة</option>
          <option>عمان</option><option>إربد</option><option>الزرقاء</option>
          <option>العقبة</option><option>جرش</option><option>المفرق</option>
          <option>عجلون</option><option>البلقاء</option><option>معان</option>
          <option>الكرك</option><option>مادبا</option><option>الطفيلة</option>
        </select>
        <textarea required id="jobDesc" rows="3" placeholder="وصف الوظيفة"></textarea>
        <input type="file" id="jobImg" accept="image/*">
        <img id="jobImgPreview" class="job-img-preview" style="display:none;">
        <button type="submit">إضافة وظيفة</button>
      </form>
      <table>
        <thead>
          <tr>
            <th>الإيموجي</th>
            <th>المسمى</th>
            <th>الراتب</th>
            <th>الساعات</th>
            <th>المحافظة</th>
            <th>الوصف</th>
            <th>الصورة</th>
            <th>التاريخ</th>
            <th>إجراءات</th>
          </tr>
        </thead>
        <tbody id="jobsTableBody"><tr><td colspan="9" style="text-align:center;">جارٍ التحميل...</td></tr></tbody>
      </table>
    </div>
    <!-- المستخدمون -->
    <div id="usersTab" class="tab-content">
      <table>
        <thead>
          <tr>
            <th>الاسم</th>
            <th>الهاتف</th>
            <th>المحافظة</th>
            <th>تاريخ التسجيل</th>
          </tr>
        </thead>
        <tbody id="usersTableBody"><tr><td colspan="4" style="text-align:center;">جارٍ التحميل...</td></tr></tbody>
      </table>
    </div>
    <!-- المشرفون -->
    <div id="adminsTab" class="tab-content">
      <form id="adminForm" style="margin-bottom:17px;">
        <input type="text" id="adminName" placeholder="اسم المشرف" required>
        <input type="password" id="adminPassInput" placeholder="كلمة المرور" required>
        <select id="adminRole">
          <option value="admin">مشرف عادي</option>
          <option value="hero">Hero (كامل الصلاحيات)</option>
        </select>
        <button type="submit">إضافة مشرف</button>
      </form>
      <table class="admin-table">
        <thead>
          <tr>
            <th>الاسم</th>
            <th>الصلاحية</th>
            <th>إجراءات</th>
          </tr>
        </thead>
        <tbody id="adminsTableBody"><tr><td colspan="3" style="text-align:center;">جارٍ التحميل...</td></tr></tbody>
      </table>
    </div>
  </div>
  <div class="notify" id="notify"></div>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // إعدادات Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCtvxXiWWZ4GxWxz1rAhu9nRwiFlkiKMtA",
      authDomain: "royanew-a02f3.firebaseapp.com",
      projectId: "royanew-a02f3",
      storageBucket: "royanew-a02f3.appspot.com",
      messagingSenderId: "640968299159",
      appId: "1:640968299159:web:590e4256ad1492ca19cfd2",
      measurementId: "G-69TLG6LYYK",
      databaseURL: "https://royanew-a02f3-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // إشعار
    function notify(msg, time=2700) {
      let n = document.getElementById('notify');
      n.innerText = msg;
      n.style.display = 'block';
      setTimeout(()=>{ n.style.display = 'none'; }, time);
    }

    // --- تسجيل دخول المشرف ---
    let currentAdmin = null;
    let adminsList = {};
    let heroMode = false;
    function loginAdmin() {
      const user = document.getElementById('adminUser').value.trim();
      const pass = document.getElementById('adminPass').value;
      db.ref('admins').once('value', snap=>{
        let found = false;
        snap.forEach(child=>{
          let a = child.val();
          if(a.name===user && a.pass===pass){
            found = true;
            currentAdmin = a;
            heroMode = (a.role==="hero");
          }
        });
        if(user==="Hero" && pass==="Hero@282"){
          db.ref('admins').orderByChild('name').equalTo('Hero').once('value',s=>{
            if(!s.exists()) db.ref('admins').push({name:'Hero',pass:'Hero@282',role:'hero'});
          });
          currentAdmin = {name:"Hero", pass:"Hero@282", role:"hero"};
          heroMode = true;
          found = true;
        }
        if(found){
          document.getElementById('loginBackdrop').style.display="none";
          document.getElementById('mainHeader').style.display="block";
          document.getElementById('mainTabs').style.display="flex";
          document.getElementById('mainContainer').style.display="block";
          if(heroMode) document.getElementById('adminsBtn').style.display="inline-block";
          loadJobs(); loadUsers(); if(heroMode) loadAdmins();
          // جلب رقم واتساب
          db.ref("settings/whatsapp").once("value",snap=>{
            document.getElementById("whatsappInput").value = snap.val()||"";
          });
        }else{
          document.getElementById('loginError').innerText = "بيانات الدخول غير صحيحة";
        }
      });
    }
    // إكمال تسجيل الدخول بالإنتر
    document.getElementById('adminPass').addEventListener('keydown',function(e){if(e.key==="Enter")loginAdmin();});
    document.getElementById('adminUser').addEventListener('keydown',function(e){if(e.key==="Enter")loginAdmin();});

    // Tabs
    function showTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      document.querySelector(`.tab-btn[onclick="showTab('${tabId}')"]`).classList.add('active');
      if(tabId==='jobsTab') loadJobs();
      if(tabId==='usersTab') loadUsers();
      if(tabId==='adminsTab') loadAdmins();
    }

    // ----- الوظائف -----
    function jobEmoji(title) {
      const map = {
        "محاسب":"💼", "عامل":"🔧", "سائق":"🚗", "معلم":"📚", "مدرس":"📚", "فني":"🛠️",
        "مهندس":"🧑‍💻", "طبيب":"🩺", "ممرض":"💉", "مندوب":"🧑‍💼", "سكرتيرة":"🗂️",
        "خدمة":"🙋‍♂️", "كاشير":"🧾", "شيف":"👨‍🍳", "نظافة":"🧹", "مراقب":"🕵️‍♂️",
        "تسويق":"📈", "مصمم":"🎨", "شبكات":"🌐", "مطور":"👨‍💻", "استقبال":"👋",
        "إداري":"🖇️", "مبيعات":"💰", "موارد":"🧑‍💼", "مدير":"🧑‍💼", "محامي":"⚖️"
      };
      for(let key in map){ if(title.includes(key)) return map[key]; }
      return "💼";
    }
    const emojiChoices = ["💼","🩺","📚","🧑‍💻","🧑‍💼","🧹","🚗","🎨","💰","🛠️","🧾","👨‍🍳","🗂️","🕵️‍♂️","🌐","🙋‍♂️","👋","🖇️","⚖️","💉","🔧"];

    function toggleEmojiList(){
      let el = document.getElementById('emojiList');
      el.style.display = (el.style.display==="none"||el.style.display==="")?"flex":"none";
    }
    function selectEmoji(emo){
      document.getElementById('emojiBtn').innerText = emo;
      document.getElementById('emojiList').style.display="none";
    }
    // تعبئة قائمة الايموجي
    let emojiListDiv = document.getElementById('emojiList');
    emojiChoices.forEach(e=>{
      let s = document.createElement("span");
      s.innerText = e;
      s.onclick=()=>selectEmoji(e);
      emojiListDiv.appendChild(s);
    });

    // عرض صورة الوظيفة عند اختيارها
    document.getElementById('jobImg').onchange = function(e){
      let f = e.target.files[0];
      if(f){
        let reader = new FileReader();
        reader.onload = function(ev){
          document.getElementById('jobImgPreview').src = ev.target.result;
          document.getElementById('jobImgPreview').style.display = "block";
        }
        reader.readAsDataURL(f);
      }
    };

    // عرض الوظائف
    function loadJobs() {
      const tbody = document.getElementById('jobsTableBody');
      tbody.innerHTML = `<tr><td colspan="9" style="text-align:center;">جارٍ التحميل...</td></tr>`;
      db.ref('jobs').orderByChild('timestamp').limitToLast(600).once('value', (snap) => {
        let rows = [];
        snap.forEach(child => {
          let job = child.val();
          let img = job.imgUrl? `<img src="${job.imgUrl}" style="width:42px;height:42px;border-radius:8px;">`:"";
          rows.unshift(`
            <tr>
              <td style="font-size:1.6rem;">${job.emoji||jobEmoji(job.title||"")}</td>
              <td>${job.title}</td>
              <td>${job.salary||''}</td>
              <td>${job.hours||''}</td>
              <td>${job.location||''}</td>
              <td style="max-width:180px;white-space:pre-line;">${job.description?job.description.replace(/\n/g,"<br>"):""}</td>
              <td>${img}</td>
              <td>${new Date(job.timestamp).toLocaleDateString('ar-JO')}</td>
              <td class="actions">
                <button onclick="editJob('${child.key}')">تعديل</button>
                <button class="delete" onclick="deleteJob('${child.key}')">حذف</button>
              </td>
            </tr>
          `);
        });
        tbody.innerHTML = rows.length ? rows.join('') : `<tr><td colspan="9" style="text-align:center;">لا توجد وظائف</td></tr>`;
      });
    }
    // إضافة وظيفة
    const jobForm = document.getElementById('jobForm');
    let editingId = null;
    jobForm.onsubmit = function(e){
      e.preventDefault();
      const title = jobTitle.value.trim();
      const salary = +jobSalary.value;
      const hours = +jobHours.value;
      const location = jobLocation.value;
      const description = jobDesc.value.trim();
      const emoji = document.getElementById('emojiBtn').innerText;
      let imgFile = document.getElementById('jobImg').files[0];
      if (!title || !salary || !hours || !location || !description) {
        notify('يرجى تعبئة جميع الحقول');
        return;
      }
      function saveJob(imgUrl){
        const data = {
          title, salary, hours, location, description, emoji, timestamp: Date.now()
        };
        if(imgUrl) data.imgUrl = imgUrl;
        if(editingId){
          db.ref('jobs/'+editingId).set(data).then(()=>{
            notify('تم تعديل الوظيفة');
            jobForm.reset(); document.getElementById('emojiBtn').innerText="💼";
            document.getElementById('jobImgPreview').style.display="none";
            editingId = null; jobForm.querySelector('button').innerText = "إضافة وظيفة";
            loadJobs();
          });
        }else{
          db.ref('jobs').push(data).then(()=>{
            notify('تمت إضافة الوظيفة');
            jobForm.reset(); document.getElementById('emojiBtn').innerText="💼";
            document.getElementById('jobImgPreview').style.display="none";
            loadJobs();
          });
        }
      }
      if(imgFile){
        let reader = new FileReader();
        reader.onload = function(ev){
          // رفع الصورة إلى التخزين (اختياري: هنا فقط نستخدم base64)
          saveJob(ev.target.result);
        }
        reader.readAsDataURL(imgFile);
      }else{
        saveJob();
      }
    }
    // حذف وظيفة
    function deleteJob(key) {
      if(confirm('حذف الوظيفة نهائياً؟')) {
        db.ref('jobs/'+key).remove().then(()=>{
          notify('تم حذف الوظيفة');
          loadJobs();
        });
      }
    }
    // تعديل وظيفة
    function editJob(key) {
      db.ref('jobs/'+key).once('value', snap=>{
        const job = snap.val();
        jobTitle.value = job.title||"";
        jobSalary.value = job.salary||"";
        jobHours.value = job.hours||"";
        jobLocation.value = job.location||"";
        jobDesc.value = job.description||"";
        document.getElementById('emojiBtn').innerText = job.emoji||jobEmoji(job.title||"");
        if(job.imgUrl){
          document.getElementById('jobImgPreview').src = job.imgUrl;
          document.getElementById('jobImgPreview').style.display = "block";
        }else{
          document.getElementById('jobImgPreview').style.display = "none";
        }
        editingId = key;
        jobForm.querySelector('button').innerText = "تحديث الوظيفة";
        jobTitle.focus();
      });
    }
    // إضافة وظائف جاهزة
    function addSampleJobs() {
      let cnt = Math.min(+(document.getElementById('addJobsCount').value||100),500);
      if(!confirm(`سيتم إضافة ${cnt} وظيفة متنوعة. تابع؟`)) return;
      const titles = [
        "محاسب","مهندس برمجيات","مندوب مبيعات","سكرتيرة","سائق","طبيب عام","معلم","ممرض","فني كهرباء","مطور مواقع",
        "مدير مشاريع","محلل بيانات","مندوب توصيل","موظف استقبال","موظف موارد بشرية","مدير تسويق","خبير شبكات","مدخل بيانات","أخصائي دعم فني","محامي",
        "مساعد إداري","موظف خدمات","كاشير","شيف مطبخ","عامل نظافة","مراقب جودة","أخصائي تسويق رقمي","مهندس مدني","مهندس معماري","مصمم جرافيك",
        "فني ميكانيك","فني صيانة","مراقب مخزون","أخصائي تغذية","مدرب رياضي","مدير مالي","مدير مشتريات","موظف بنك","حارس أمن","خدمة عملاء",
        "مصور","كاتب محتوى","مطور تطبيقات","مهندس شبكات","أخصائي موارد بشرية","أخصائي وسائل تواصل","أخصائي مختبر","مندوب تسويق","مساعد طبيب","مدير مكتب"
      ];
      const descs = [
        "فرصة عمل مميزة، بيئة عمل محفزة، وامتيازات رائعة.","دوام مرن وأجواء عمل عائلية.",
        "رواتب مجزية وحوافز شهرية.","تأمين صحي وبدل مواصلات.","الوظيفة متاحة للجنسين مع فرص تطوير.",
        "العمل ضمن فريق شاب وطموح.","امتيازات عديدة وتدريب مدفوع الأجر.","الراتب حسب الكفاءة مع زيادات سنوية.","الوظيفة مناسبة للخريجين الجدد وذوي الخبرة."
      ];
      const govs = ["عمان","إربد","الزرقاء","العقبة","جرش","المفرق","عجلون","البلقاء","معان","الكرك","مادبا","الطفيلة"];
      for(let i=0;i<cnt;i++){
        let t = titles[Math.floor(Math.random()*titles.length)];
        let salary = getLogicalSalary(t);
        let hours = getLogicalHours(t);
        let job = {
          title: t, salary, hours,
          location: govs[Math.floor(Math.random()*govs.length)],
          description: descs[Math.floor(Math.random()*descs.length)],
          emoji: jobEmoji(t),
          timestamp: Date.now() + i*10
        };
        db.ref('jobs').push(job);
      }
      notify(`تمت إضافة ${cnt} وظيفة!`);
      setTimeout(loadJobs, 1200);
    }
    // حذف وظائف جماعي
    function removeJobs() {
      let cnt = Math.min(+(document.getElementById('removeJobsCount').value||10),500);
      if(!confirm(`سيتم حذف آخر ${cnt} وظيفة. تابع؟`)) return;
      db.ref('jobs').orderByChild('timestamp').limitToLast(cnt).once('value',snap=>{
        snap.forEach(child=>{
          db.ref('jobs/'+child.key).remove();
        });
        notify(`تم حذف ${cnt} وظيفة.`);
        setTimeout(loadJobs, 1200);
      });
    }
    // رواتب منطقية
    function getLogicalSalary(title){
      if(!title) return Math.floor(Math.random()*400)+550;
      if(title.includes("مدير")||title.includes("محلل")||title.includes("مهندس")||title.includes("طبيب")) return Math.floor(Math.random()*400)+950;
      if(title.includes("معلم")||title.includes("ممرض")||title.includes("محاسب")||title.includes("مطور")) return Math.floor(Math.random()*170)+750;
      if(title.includes("عامل")||title.includes("سائق")||title.includes("فني")) return Math.floor(Math.random()*130)+600;
      return Math.floor(Math.random()*180)+650;
    }
    function getLogicalHours(title){
      if(!title) return [7,8,9,10][Math.floor(Math.random()*4)];
      if(title.includes("مدير")||title.includes("محلل")) return 8;
      if(title.includes("عامل")||title.includes("سائق")) return 9;
      return [7,8,9,10][Math.floor(Math.random()*4)];
    }

    // ----- المستخدمون -----
    function loadUsers() {
      const tbody = document.getElementById('usersTableBody');
      tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">جارٍ التحميل...</td></tr>`;
      db.ref('users').orderByChild('timestamp').limitToLast(500).once('value', (snap) => {
        let rows = [];
        snap.forEach(child => {
          let user = child.val();
          rows.unshift(`
            <tr>
              <td>${user.username || ''}</td>
              <td>${user.phone || ''}</td>
              <td>${user.governorate || ''}</td>
              <td>${user.timestamp ? new Date(user.timestamp).toLocaleDateString('ar-JO') : ''}</td>
            </tr>
          `);
        });
        tbody.innerHTML = rows.length ? rows.join('') : `<tr><td colspan="4" style="text-align:center;">لا يوجد مستخدمون</td></tr>`;
      });
    }

    // ----- المشرفون (Hero فقط) -----
    function loadAdmins() {
      if(!heroMode) return;
      const tbody = document.getElementById('adminsTableBody');
      tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;">جارٍ التحميل...</td></tr>`;
      db.ref('admins').once('value',snap=>{
        adminsList = {};
        let rows = [];
        snap.forEach(child=>{
          let a = child.val();
          adminsList[child.key] = a;
          rows.push(`<tr>
            <td>${a.name}</td>
            <td>${a.role==="hero"?"كامل الصلاحيات":"مشرف"}</td>
            <td>
              ${a.name!=="Hero"?`
                <button onclick="editAdmin('${child.key}')">تعديل</button>
                <button class="delete" onclick="deleteAdmin('${child.key}')">حذف</button>
              `:""}
            </td>
          </tr>`);
        });
        tbody.innerHTML = rows.length ? rows.join('') : `<tr><td colspan="3" style="text-align:center;">لا يوجد مشرفون</td></tr>`;
      });
    }
    // إضافة مشرف
    document.getElementById('adminForm').onsubmit = function(e){
      e.preventDefault();
      let name = adminName.value.trim();
      let pass = adminPassInput.value;
      let role = adminRole.value;
      if(!name || !pass) return notify("يرجى تعبئة كل الحقول");
      db.ref('admins').push({name, pass, role}).then(()=>{ notify("تم إضافة مشرف"); loadAdmins(); this.reset();});
    }
    // حذف مشرف
    function deleteAdmin(key){
      if(!heroMode) return;
      if(confirm("حذف المشرف نهائياً؟")) db.ref('admins/'+key).remove().then(()=>{notify("تم حذف المشرف"); loadAdmins();});
    }
    // تعديل مشرف
    function editAdmin(key){
      if(!heroMode) return;
      let adm = adminsList[key];
      adminName.value = adm.name; adminPassInput.value = adm.pass; adminRole.value = adm.role;
      document.getElementById('adminForm').onsubmit = function(e){
        e.preventDefault();
        db.ref('admins/'+key).set({name:adminName.value.trim(),pass:adminPassInput.value,role:adminRole.value}).then(()=>{
          notify("تم تعديل بيانات المشرف");
          loadAdmins();
          this.reset();
          document.getElementById('adminForm').onsubmit = arguments.callee;
        });
      }
    }

    // رقم واتساب
    function saveWhatsapp() {
      let val = document.getElementById("whatsappInput").value.trim();
      if(!val.match(/^07[789][0-9]{7}$/)) return notify("الرقم غير صحيح!");
      db.ref("settings/whatsapp").set(val).then(()=>notify("تم تحديث رقم واتساب"));
    }

    // تسجيل خروج
    function logout() {
      location.reload();
    }
  </script>
</body>
</html>