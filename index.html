<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>بوابة وظائف رؤيا | الأردن</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Tajawal:400,700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Tajawal', Arial, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e4ecf7 100%);
      margin: 0; padding: 0; color: #222; min-height: 100vh; position: relative;
    }
    header {
      background: #6900ad; color: #fff;
      padding: 20px 0 10px 0; text-align: center; box-shadow: 0 3px 16px #865fc44d;
      position: sticky; top: 0; z-index: 10;
    }
    .logo { height: 68px; margin-bottom: 6px; }
    h1 { margin: 0 0 8px 0; font-size: 2.2rem; font-weight: 700; letter-spacing: 1px; }
    .subtitle { font-size: 1.2rem; color: #e5d7f9; margin-bottom: 5px; }
    .container {
      max-width: 1100px; margin: 32px auto 18px auto; padding: 16px; background: #fff;
      border-radius: 18px; box-shadow: 0 2px 22px #a97be73f; position: relative; z-index: 1;
    }
    .stats {
      display: flex; gap: 20px; justify-content: center; margin: 18px 0 30px 0;
      flex-wrap: wrap;
    }
    .stat {
      background: #6900ad; color: #fff; padding: 18px 32px; border-radius: 15px;
      font-size: 1.1rem; font-weight: 600; box-shadow: 0 1px 4px #0001; text-align: center;
      min-width: 150px;
    }
    .jobs-list {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(270px, 1fr)); gap: 24px;
    }
    .job-card {
      background: #f7f2ff; border: 2px solid #e4d4f7; border-radius: 14px;
      padding: 24px 20px 16px 20px; box-shadow: 0 1px 8px #a97be712;
      position: relative; overflow: hidden; min-height: 220px;
      display: flex; flex-direction: column; justify-content: space-between;
      transition:box-shadow 0.2s;
    }
    .job-card:hover { box-shadow:0 3px 18px #6900ad1b; }
    .job-title { font-size: 1.23rem; font-weight: bold; color: #6900ad; margin-bottom: 8px; }
    .job-info { font-size: 1.02rem; margin-bottom: 6px; color: #333; }
    .job-province { font-size: 0.99rem; color: #49007e; margin-bottom: 6px; }
    .salary { font-weight: bold; color: #0a6c19; margin-bottom: 6px; }
    .hours { color: #ad6c00; margin-bottom: 6px; }
    .company-logo {
      width: 70px; height: 70px; object-fit:cover;
      border-radius: 13px; margin-bottom: 9px; box-shadow:0 1px 8px #6900ad1c;
      background:#fff;
    }
    .fav-btn {
      position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5rem;cursor:pointer;color:#fdc800;
      z-index:1;
    }
    .fav-btn.fav { color: #f9d13d; }
    .btn-filter {
      background:#fff;color:#6900ad;font-size:.97rem;border-radius:7px;border:1px solid #6900ad;padding:4px 14px;cursor:pointer;margin-bottom:8px;margin-left:6px;
      transition:background 0.2s,color 0.2s;
    }
    .btn-filter.active {background:#6900ad;color:#fff;}
    /* Footer */
    footer {
      background: #f7f2ff; color: #6900ad; text-align: center; padding: 18px 0 10px 0; border-radius: 18px 18px 0 0;
      font-size: 1.07rem; margin: 23px 0 0 0; box-shadow: 0 -2px 12px #a97be71a;
    }
    @media (max-width: 700px) {
      .container { padding: 6px; }
      .stats { flex-direction: column; gap: 12px; }
      .job-card { padding: 14px 4px 10px 4px; }
      .company-logo { width:50px;height:50px;}
    }
  </style>
  <script type="module">
    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    // بيانات فايربيس الخاصة بك
    const firebaseConfig = {
      apiKey: "AIzaSyBr03bRk3uNzLCFzr53ufdPbA3DrOZHxWQ",
      authDomain: "jobsroya.firebaseapp.com",
      projectId: "jobsroya",
      storageBucket: "jobsroya.firebasestorage.app",
      messagingSenderId: "882520191513",
      appId: "1:882520191513:web:2165131b20e33bdc38b088",
      measurementId: "G-RW67K10VPD",
      databaseURL: "https://jobsroya-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let jobsData = [];
    let jobsAll = [];
    let stats = {jobs:0, users:0, provinces:12, companies:0};
    let favJobs = JSON.parse(localStorage.getItem("favJobs")||"[]");

    // تحميل الوظائف من فايربيس
    function fetchJobs() {
      onValue(ref(db, "jobs"), snap=>{
        jobsAll = [];
        if(snap.val()) {
          Object.values(snap.val()).forEach(j=>jobsAll.push(j));
        }
        jobsData = jobsAll;
        stats.jobs = jobsData.length;
        stats.companies = [...new Set(jobsData.map(j=>j.company))].length;
        renderJobs();
        renderStats();
        renderFilters();
      });
    }
    fetchJobs();

    function renderJobs(filProvince="",filType="") {
      let jobs = jobsData;
      if(filProvince) jobs = jobs.filter(j=>j.province===filProvince);
      if(filType) jobs = jobs.filter(j=>j.type===filType);
      const list = document.getElementById("jobs-list");
      list.innerHTML = "";
      if(!jobs.length) {
        list.innerHTML = "<div style='text-align:center;padding:30px;font-size:1.2rem;color:#6900ad'>لا يوجد وظائف ضمن هذا التصنيف حاليًا.</div>";
        return;
      }
      jobs.forEach((job, idx) => {
        let isFav = favJobs.includes(idx);
        list.innerHTML += `
        <div class="job-card">
          <button class="fav-btn${isFav?' fav':''}" title="إضافة للمفضلة" onclick="toggleFav(${idx})"><span id="fav-${idx}">${isFav?"★":"☆"}</span></button>
          ${job.logo?`<img class="company-logo" src="${job.logo}" alt="شعار الشركة"/>`:""}
          <div class="job-title">${job.title}</div>
          <div class="job-info">${job.desc||""}</div>
          <div style="margin-bottom:7px;">الشركة: <b>${job.company||"--"}</b></div>
          <div class="salary">الراتب: ${job.salary} دينار</div>
          <div class="hours">ساعات العمل: ${job.hours} ساعة</div>
          <div class="job-province">المحافظة: <span>${job.province||"--"}</span></div>
          <div style="font-size:.98rem;margin-bottom:6px;">نوع الدوام: <b>${job.type||"--"}</b></div>
          <div style="font-size:.98rem;margin-bottom:6px;">الخبرة المطلوبة: <b>${job.exp||"--"}</b></div>
        </div>`;
      });
      updateFavBtns();
    }
    function renderStats() {
      document.getElementById("stat-jobs").innerHTML = `عدد الوظائف: <span>${stats.jobs}</span>`;
      document.getElementById("stat-companies").innerHTML = `عدد الشركات: <span>${stats.companies}</span>`;
      document.getElementById("stat-provinces").innerHTML = `المحافظات: <span>12</span>`;
    }
    function renderFilters() {
      let provinces = [...new Set(jobsAll.map(j=>j.province))].filter(Boolean);
      let types = [...new Set(jobsAll.map(j=>j.type))].filter(Boolean);
      let provHtml = `<button class="btn-filter" onclick="filterJobs('','')">الكل</button>`;
      provinces.forEach(p=>{
        provHtml += `<button class="btn-filter" onclick="filterJobs('${p}','')">${p}</button>`;
      });
      let typeHtml = `<button class="btn-filter" onclick="filterJobs('','')">الكل</button>`;
      types.forEach(t=>{
        typeHtml += `<button class="btn-filter" onclick="filterJobs('','${t}')">${t}</button>`;
      });
      document.getElementById("filter-province").innerHTML = provHtml;
      document.getElementById("filter-type").innerHTML = typeHtml;
    }
    window.filterJobs = function(prov,type) {
      renderJobs(prov,type);
    }
    window.toggleFav = function(idx) {
      let i = favJobs.indexOf(idx);
      if(i>-1) favJobs.splice(i,1); else favJobs.push(idx);
      localStorage.setItem("favJobs", JSON.stringify(favJobs));
      updateFavBtns();
    }
    function updateFavBtns() {
      document.querySelectorAll(".fav-btn").forEach((btn,idx)=>{
        let span = document.getElementById("fav-"+idx);
        if(span) span.textContent = favJobs.includes(idx) ? "★" : "☆";
        if(favJobs.includes(idx)) btn.classList.add("fav"); else btn.classList.remove("fav");
      });
    }
  </script>
</head>
<body>
  <header>
    <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/ROYA_TV_LOGO.svg/512px-ROYA_TV_LOGO.svg.png" alt="شعار رؤيا"/>
    <h1>بوابة وظائف رؤيا</h1>
    <div class="subtitle">كل فرص العمل المتاحة في الأردن بين يديك</div>
  </header>
  <div class="container">
    <div class="stats">
      <div class="stat" id="stat-jobs">عدد الوظائف: <span>--</span></div>
      <div class="stat" id="stat-companies">عدد الشركات: <span>--</span></div>
      <div class="stat" id="stat-provinces">المحافظات: <span>12</span></div>
    </div>
    <div style="margin-bottom:16px;display:flex;justify-content:center;flex-wrap:wrap;">
      <div id="filter-province" style="margin-left:16px;"></div>
      <div id="filter-type"></div>
    </div>
    <div class="jobs-list" id="jobs-list"></div>
  </div>
  <footer>
    جميع الحقوق محفوظة &copy; قناة رؤيا 2025 — تصميم وتطوير: فريق رؤيا الرقمي
    <br>
    <a href="admin.html" style="color:#6900ad;font-size:0.98rem;">لوحة تحكم المشرف</a>
  </footer>
</body>
</html>