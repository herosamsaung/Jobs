<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨ÙˆØ§Ø¨Ø© ÙˆØ¸Ø§Ø¦Ù Ø±Ø¤ÙŠØ§ | Ø§Ù„Ø£Ø±Ø¯Ù†</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Tajawal:400,700&display=swap" rel="stylesheet">
  <link rel="icon" href="https://www2.0zz0.com/2025/10/15/17/197165129.png">
  <style>
    /* ... Ø¬Ù…ÙŠØ¹ CSS Ø§Ù„Ø£ØµÙ„ÙŠ + ØªØ­Ø³ÙŠÙ†Ø§Øª ... */
    body {
      font-family: 'Tajawal', Arial, sans-serif;
      background: linear-gradient(135deg, #e8eafc 0%, #e4ecf7 100%);
      margin: 0; padding: 0; color: #222; min-height: 100vh;
      transition: background 0.3s;
    }
    body.dark { background: #241740; color:#fff; }
    header {
      background: #6900ad;
      color: #fff;
      padding: 20px 0 10px 0;
      text-align: center;
      box-shadow: 0 3px 16px #865fc44d;
      position:relative;
    }
    .logo {
      height: 68px; margin-bottom: 7px; border-radius: 16px; background: #fff5;
      box-shadow: 0 2px 18px #fff9;
    }
    .site-title {font-size:2.1rem;font-weight:700;}
    .site-subtitle {font-size:1.13rem;color:#6900ad;}
    body.dark .site-subtitle {color:#f9d13d;}
    .container {
      max-width: 1200px; margin: 32px auto 18px auto; padding: 18px;
      background: #fff; border-radius: 20px; box-shadow: 0 2px 22px #a97be73f;
    }
    body.dark .container { background: #241740; color: #e7e5f7; }
    .stats {
      display: flex; gap: 20px; justify-content: center; margin: 18px 0 30px 0; flex-wrap: wrap;
    }
    .stat {
      background: #6900ad; color: #fff; padding: 18px 32px; border-radius: 15px;
      font-size: 1.1rem; font-weight: 600; min-width: 150px; display:flex;align-items:center;gap:7px;
    }
    .jobs-list {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(290px, 1fr)); gap: 24px;
    }
    .job-card {
      background: #fff; border: 1.5px solid #d6c6ed; border-radius: 16px;
      padding: 22px 18px 18px 18px; box-shadow: 0 6px 36px #a97be713;
      transition:box-shadow .17s;
      display:flex;flex-direction:column;gap:7px;
    }
    body.dark .job-card { background: #2b1d45; color: #ebebf8; border-color: #51306d; }
    .job-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .job-icon { font-size: 2.2rem; background: #f1e7ff; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; }
    .job-img { width: 42px; height: 42px; border-radius: 50%; object-fit:cover; background:#eee; }
    body.dark .job-icon { background: #321e53; }
    .job-title { font-size: 1.19rem; font-weight: bold; color: #6900ad; }
    body.dark .job-title { color: #f9d13d; }
    .job-desc {font-size:1.04rem;margin:0 0 3px 0;}
    .job-info-table { width: 100%; font-size: 1.05rem; margin: 8px 0 8px 0; }
    .salary { font-weight: bold; color: #0a6c19; }
    body.dark .salary { color: #89fa8e; }
    .apply-btn {
      background: linear-gradient(90deg, #8400d3 0%, #a97be7 100%);
      color: #fff; border: none; border-radius: 10px; padding: 11px 0;
      font-size: 1.1rem; font-weight: 700; cursor: pointer; width: 100%;
      transition:background .15s;
    }
    .apply-btn:active {transform:scale(.97);}
    #dark-toggle {
      position:fixed;top:24px;left:28px;z-index:11111;background:#fff;border-radius:50%;width:43px;height:43px;display:flex;align-items:center;justify-content:center; font-size:1.7rem;color:#6900ad; box-shadow:0 1px 12px #6900ad19; cursor:pointer;
    }
    #toast { min-width:200px;position:fixed;bottom:95px;left:50%;transform:translateX(-50%);z-index:10000;background:#6900ad;color:#fff; padding:14px 30px;border-radius:12px;display:none;font-size:1.08rem; box-shadow:0 2px 18px #a97be73f;}
    footer { background: #f7f2ff; color: #6900ad; text-align: center; padding: 18px 0 10px 0; border-radius: 18px 18px 0 0; font-size: 1.07rem; margin: 23px 0 0 0; box-shadow: 0 -2px 12px #a97be71a; }
    body.dark footer {background:#241740;color:#f9d13d;}
    .modal-bg { position: fixed; inset: 0; background: #0008; z-index: 10000; display: flex; align-items: center; justify-content: center;}
    .modal { background: #fff; border-radius: 18px; max-width: 98vw; width: 370px; box-shadow: 0 4px 32px #6900ad3a; padding: 38px 20px 28px 20px; text-align: center;}
    .modal input, .modal select {
      border:1.5px solid #cbb7eb;border-radius:13px;padding:10px 12px;font-size:1.13rem;
      width:85%;margin-bottom:9px;outline:none;background:#f7f2ff;
    }
    .modal .modal-title {font-size:1.22rem;font-weight:700;color:#6900ad;margin-bottom:8px;}
    .modal .modal-icon {font-size:2.4rem;margin-bottom:11px;color:#a97be7;}
    .modal .modal-btn {margin-top:13px;}
    .modal .err {color:#b30000;font-size:1rem;}
    .modal .close-x {position:absolute;top:8px;left:14px;font-size:1.34rem;cursor:pointer;}
    .success { color: #127c01; font-size: 1.09rem; margin:12px 0;font-weight: bold;}
    .pending { color: #ad6c00;font-size:1.07rem;margin:12px 0;font-weight: bold;}
    .rejected { color: #b30000;font-size:1.07rem;margin:12px 0;font-weight: bold;}
    .pay-info { background: #f7f3ff; border-radius: 12px; padding: 10px; margin:10px 0 14px 0; color: #6900ad; font-size:1.08rem;}
    .pay-info .amount { color:#b30000;font-weight:700;font-size:1.13rem;}
    .pay-info .benef { color:#127c01;font-weight:600;}
    .pay-info .bank { color:#6900ad;font-weight:600;}
    .pay-info .ref { color:#0a6c19;font-weight:700;}
    .logo-upload {width:120px;margin:auto;display:block;}
    .req-status {font-size:1.09rem;font-weight:700;margin:8px 0;}
    .req-status.pending {color:#ad6c00;}
    .req-status.approved {color:#127c01;}
    .req-status.rejected {color:#b30000;}
    .search-bar {
      margin-bottom:14px; text-align:center;
      display:flex;justify-content:center;gap:12px;flex-wrap:wrap;
    }
    .search-bar input, .search-bar select {
      padding:8px 11px;border-radius:11px;border:1.5px solid #cbb7eb;font-size:1.09rem;
      outline:none;
    }
    .follow-btn {
      margin:14px auto;display:block;background:#f7f2ff;color:#6900ad;border:1.5px solid #6900ad;
      border-radius:12px;padding:10px 35px;font-weight:700;font-size:1.13rem;cursor:pointer;transition:background .14s;
    }
    .follow-btn:active {transform:scale(.97);}
    .download-contract-btn {
      background: linear-gradient(90deg, #127c01 0%, #6900ad 100%);
      color: #fff; border: none; border-radius: 10px; padding: 11px 0;
      font-size: 1.1rem; font-weight: 700; cursor: pointer; width: 100%;
      margin-top: 10px; transition:background .15s;
      box-shadow: 0 2px 12px #127c0140;
    }
    .download-contract-btn:active {transform:scale(.97);}
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
    .progress-bar {width:90%;background:#f1e7ff;height:12px;border-radius:7px;overflow:hidden;margin:16px auto;}
    .progress-bar-inner {height:100%;background:linear-gradient(90deg,#6900ad,#f9d13d);transition:width .3s;}
    @media (max-width: 700px) {
      .container { padding: 6px; }
      .stats { flex-direction: column; gap: 12px; }
      .modal { width: 97vw; padding: 28px 3vw 20px 3vw; }
      .job-card { padding: 12px 3px 10px 3px; }
      #dark-toggle { left: 12px; top: 12px; }
      .logo {width:60px;}
    }
  </style>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <!-- jsPDF PDF library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div id="dark-toggle" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ/Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ">ğŸŒ™</div>
  <header>
    <img class="logo" id="logo-img" src="https://www2.0zz0.com/2025/10/15/17/197165129.png" alt="Ø´Ø¹Ø§Ø± Ø±Ø¤ÙŠØ§"/>
    <div class="site-title" id="site-title">Ø¨ÙˆØ§Ø¨Ø© ÙˆØ¸Ø§Ø¦Ù Ø±Ø¤ÙŠØ§</div>
    <div class="site-subtitle" id="site-subtitle">ÙƒÙ„ ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ø£Ø±Ø¯Ù† Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ â€” ØªØµÙØ­ ÙˆÙ‚Ø¯Ù… Ø¨Ø°ÙƒØ§Ø¡!</div>
  </header>
  <div class="container">
    <div class="stats">
      <div class="stat" id="stat-jobs"><span>ğŸ—‚ï¸</span> Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…ØªØ§Ø­Ø©: <span>--</span></div>
      <div class="stat" id="stat-apps"><span>ğŸ“‹</span> Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…: <span>--</span></div>
    </div>
    <div class="search-bar">
      <input id="search" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¸ÙŠÙØ© Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©..." />
      <select id="filter-province">
        <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
        <option>Ø¹Ù…Ø§Ù†</option><option>Ø¥Ø±Ø¨Ø¯</option><option>Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡</option><option>Ø§Ù„Ø¹Ù‚Ø¨Ø©</option>
        <option>Ø§Ù„Ù…ÙØ±Ù‚</option><option>Ø§Ù„Ø³Ù„Ø·</option><option>Ø¬Ø±Ø´</option>
        <option>Ø¹Ø¬Ù„ÙˆÙ†</option><option>Ù…Ø£Ø¯Ø¨Ø§</option><option>Ø§Ù„ÙƒØ±Ùƒ</option>
        <option>Ø§Ù„Ø·ÙÙŠÙ„Ø©</option><option>Ù…Ø¹Ø§Ù†</option>
        <option>ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
      </select>
    </div>
    <div class="jobs-list" id="jobs-list"></div>
    <button class="follow-btn" onclick="showRequests()">Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ</button>
  </div>
  <footer id="footer-msg">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; Ù‚Ù†Ø§Ø© Ø±Ø¤ÙŠØ§ 2025 â€” ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: ÙØ±ÙŠÙ‚ Ø±Ø¤ÙŠØ§ Ø§Ù„Ø±Ù‚Ù…ÙŠ</footer>
  <div id="toast"></div>
  <!-- ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ -->
  <div class="modal-bg" id="login-modal-bg">
    <div class="modal" id="login-modal">
      <span class="close-x" onclick="document.getElementById('login-modal-bg').style.display='none'">&times;</span>
      <div class="modal-icon">ğŸ‘¤</div>
      <div class="modal-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
      <input type="text" id="name-input" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" autocomplete="name"/>
      <input type="tel" id="phone-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" maxlength="10" autocomplete="tel"/>
      <select id="province-input">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
        <option>Ø¹Ù…Ø§Ù†</option><option>Ø¥Ø±Ø¨Ø¯</option><option>Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡</option><option>Ø§Ù„Ø¹Ù‚Ø¨Ø©</option>
        <option>Ø§Ù„Ù…ÙØ±Ù‚</option><option>Ø§Ù„Ø³Ù„Ø·</option><option>Ø¬Ø±Ø´</option>
        <option>Ø¹Ø¬Ù„ÙˆÙ†</option><option>Ù…Ø£Ø¯Ø¨Ø§</option><option>Ø§Ù„ÙƒØ±Ùƒ</option>
        <option>Ø§Ù„Ø·ÙÙŠÙ„Ø©</option><option>Ù…Ø¹Ø§Ù†</option>
        <option>ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
      </select>
      <button class="apply-btn modal-btn" id="login-btn">Ø¯Ø®ÙˆÙ„</button>
      <div id="login-error" class="err"></div>
    </div>
  </div>
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… -->
  <div class="modal-bg" id="apply-modal-bg" style="display:none">
    <div class="modal" id="apply-modal"></div>
  </div>
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
  <div class="modal-bg" id="req-modal-bg" style="display:none">
    <div class="modal" id="req-modal"></div>
  </div>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDC8Gx2IJRDTMzR42_kbv_tuT9i11-KRzk",
      authDomain: "royajobs.firebaseapp.com",
      databaseURL: "https://royajobs-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "royajobs",
      storageBucket: "royajobs.firebasestorage.app",
      messagingSenderId: "914105960159",
      appId: "1:914105960159:web:d5f17f3edc5e26a5b58b6a",
      measurementId: "G-N7C9WJZBD8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ù„Ù„Ø¬Ù‡Ø§Ø² (Device UUID)
    function getDeviceId() {
      let id = localStorage.getItem("deviceId");
      if (!id) {
        id = "device-" + ([...Array(32)].map(()=>Math.random().toString(16)[2]).join(""));
        localStorage.setItem("deviceId", id);
      }
      return id;
    }
    const deviceId = getDeviceId();

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø´Ø¹Ø§Ø± Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ³
    function loadSiteSettings() {
      db.ref("settings").once("value", snap=>{
        const s = snap.val()||{};
        if(s.title) document.getElementById("site-title").textContent=s.title;
        if(s.subtitle) document.getElementById("site-subtitle").textContent=s.subtitle;
        if(s.logo) document.getElementById("logo-img").src=s.logo;
        if(s.footer) document.getElementById("footer-msg").textContent=s.footer;
        if(s.mainColor) document.querySelectorAll(".stat, .apply-btn").forEach(x=>x.style.background=s.mainColor);
        if(s.secondaryColor) document.querySelectorAll(".stat").forEach(x=>x.style.color=s.secondaryColor);
      });
    }
    loadSiteSettings();

    // Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ³
    let jobsData = [], jobsKeys = [];
    let myProvince = "";
    let myPhone = "";
    let myUser = null;
    function loadJobs() {
      db.ref("jobs").once("value", snap => {
        if(snap.exists()){
          jobsData = Object.values(snap.val());
          jobsKeys = Object.keys(snap.val());
          renderJobs();
        } else {
          jobsData = [];
          jobsKeys = [];
          renderJobs();
        }
      });
    }
    function renderJobs(filter="") {
      let jobs = jobsData;
      let province = document.getElementById("filter-province").value;
      if(province && province !== "" && province !== "ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª") jobs = jobs.filter(j=>j.province===province || j.province==="ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª");
      if(filter && filter.trim()!=="") jobs = jobs.filter(j => (j.title+j.desc+j.company+j.province+j.type).includes(filter));
      const list = document.getElementById("jobs-list");
      list.innerHTML = "";
      if(!jobs.length) list.innerHTML = `<div style="font-size:1.16rem;padding:44px 0;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
      jobs.forEach((job, idx) => {
        let imgHtml = job.img ? `<div class="job-icon">${job.img}</div>` : "";
        if(job.imgUrl) imgHtml = `<img class="job-img" src="${job.imgUrl}" alt="ØµÙˆØ±Ø©">`;
        list.innerHTML += `
        <div class="job-card">
          <div class="job-header">${imgHtml}<div class="job-title">${job.title}</div></div>
          <div class="job-desc">${job.desc||""}</div>
          <table class="job-info-table">
            <tr><td>Ø§Ù„Ø´Ø±ÙƒØ©:</td><td>${job.company||"--"}</td></tr>
            <tr><td>Ø§Ù„Ù†ÙˆØ¹:</td><td>${job.type||"--"}</td></tr>
            <tr><td>Ø§Ù„Ø®Ø¨Ø±Ø©:</td><td>${job.exp||"--"}</td></tr>
            <tr><td>Ø§Ù„Ø±Ø§ØªØ¨:</td><td class="salary">${job.salary||"--"} Ø¯ÙŠÙ†Ø§Ø±</td></tr>
            <tr><td>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:</td><td>${job.hours||"--"} Ø³Ø§Ø¹Ø©</td></tr>
          </table>
          <button class="apply-btn" onclick="openApplyModal('${jobsKeys[idx]}')">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¢Ù†</button>
        </div>`;
      });
      document.querySelector("#stat-jobs span").textContent = jobs.length;
      db.ref("applications").once("value", snap=>{
        let allApps = snap.exists()?Object.values(snap.val()):[];
        document.querySelector("#stat-apps span").textContent = allApps.filter(a=>a.timestamp && new Date(a.timestamp).toDateString()===new Date().toDateString()).length;
      });
    }
    document.getElementById("search").oninput = function() { renderJobs(this.value); }
    document.getElementById("filter-province").onchange = function(){
      myProvince = this.value;
      renderJobs(document.getElementById("search").value);
    }

    // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
    let dark = localStorage.getItem("darkMode")==="1";
    function setDarkMode(on) {
      dark = on;
      if(on) document.body.classList.add("dark"); else document.body.classList.remove("dark");
      localStorage.setItem("darkMode",on?"1":"0");
    }
    setDarkMode(dark);
    document.getElementById("dark-toggle").onclick = function(){ setDarkMode(!dark);}
    window.showToast = function(msg, duration=2500) {
      let toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(()=>{toast.style.display="none";}, duration);
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø±Ø¨Ø· Ø§Ù„Ø¬Ù‡Ø§Ø²
    window.onload = function() {
      // ØªØ­Ù‚Ù‚ Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ø£Ùˆ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²
      checkUserStatus();
    };

    function checkUserStatus() {
      let user = localStorage.getItem("ruyaJobsUser");
      if (!user) {
        document.getElementById("login-modal-bg").style.display="flex";
      } else {
        myUser = JSON.parse(user);
        myProvince = myUser.province;
        myPhone = myUser.phone;
        document.getElementById("province-input").value = myProvince;
        document.getElementById("filter-province").value = myProvince;
        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¬Ù‡Ø§Ø²
        db.ref("applications").orderByChild("deviceId").equalTo(deviceId).once("value", snap=>{
          if (snap.exists()) {
            let apps = Object.values(snap.val());
            let activeApp = apps.find(a => a.status === "approved" && a.paymentStatus !== "done");
            if (activeApp) {
              window.showToast("Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ù‚Ø¨Ù„ ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯.");
              renderJobs();
            } else {
              loadJobs();
            }
          } else {
            loadJobs();
          }
        });
      }
    }

    document.getElementById("login-btn").onclick = function() {
      const name = document.getElementById("name-input").value.trim();
      const phone = document.getElementById("phone-input").value.trim();
      const province = document.getElementById("province-input").value;
      let error = "";
      if(!name) error = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…";
      else if(!/^07[789]\d{7}$/.test(phone)) error = "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø£Ø±Ø¯Ù†ÙŠ ØµØ­ÙŠØ­";
      else if(!province) error = "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©";
      if(error) { document.getElementById("login-error").textContent = error; return; }
      myUser = { name, phone, province, uid: phone, deviceId };
      myProvince = province;
      myPhone = phone;
      localStorage.setItem("ruyaJobsUser", JSON.stringify(myUser));
      db.ref("users/"+phone).set({...myUser, timestamp: new Date().toISOString()});
      document.getElementById("login-modal-bg").style.display = "none";
      document.getElementById("filter-province").value = province;
      loadJobs();
    };

    // ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ (Ø®Ø·ÙˆØ§Øª Ø±Ø³Ù…ÙŠØ©)
    window.openApplyModal = function(jobKey) {
      // ØªØ­Ù‚Ù‚ Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„/Ù‚ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
      db.ref("applications").orderByChild("deviceId").equalTo(deviceId).once("value", snap=>{
        let apps = snap.exists()?Object.values(snap.val()):[];
        let activeApp = apps.find(a => a.status === "approved" && a.paymentStatus !== "done");
        if (activeApp) {
          window.showToast("Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø£Ùˆ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø£ÙˆÙ„Ø§Ù‹.");
          return;
        }
        // ØªØ§Ø¨Ø¹ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…
        startApplySteps(jobKey);
      });
    }

    function startApplySteps(jobKey) {
      const modal = document.getElementById("apply-modal");
      let step = 0, appId = null, job = null, appStatus = "pending", adminMsg = "";
      let progress = [20, 40, 60, 80, 100];
      db.ref("jobs/"+jobKey).once("value", snap=>{
        job = snap.val();
        renderStep();
      });
      function nextStep() { step++; renderStep(); }
      function prevStep() { if(step>0) {step--; renderStep();} }
      function renderStep() {
        modal.innerHTML = `<div class="progress-bar"><div class="progress-bar-inner" style="width:${progress[step]||100}%"></div></div>`;
        if(step===0){
          modal.innerHTML += `
            <div class="modal-title">ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ¸ÙŠÙ</div>
            <div style="font-size:1.12rem;margin-bottom:9px;"><b>${(job.img||"ğŸ’¼")} ${job.title}</b></div>
            <div>Ø§Ù„Ø´Ø±ÙƒØ©: <b>${job.company||"--"}</b></div>
            <div>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: <b>${job.hours||"--"}</b></div>
            <div style="margin:7px 0 14px 0;">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ©ØŸ</div>
            <button class="apply-btn modal-btn" onclick="nextStep()">Ù…ÙˆØ§ÙÙ‚Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</button>
            <button class="apply-btn light" style="margin-top:8px;background:#f7f2ff;color:#6900ad;border:1px solid #6900ad;" onclick="closeApplyModal()">Ø¥Ù„ØºØ§Ø¡</button>
          `;
        } else if(step===1){
          modal.innerHTML += `
            <div class="modal-title">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</div>
            <div>Ø§Ù„Ø§Ø³Ù…: <b>${myUser.name}</b></div>
            <div>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: <b>${myUser.phone}</b></div>
            <div>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: <b>${myUser.province}</b></div>
            <div style="margin:8px 0;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.</div>
            <button class="apply-btn modal-btn" onclick="nextStep()">Ø¨ÙŠØ§Ù†Ø§ØªÙŠ ØµØ­ÙŠØ­Ø©</button>
            <button class="apply-btn light" style="margin-top:8px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="prevStep()">Ø¹ÙˆØ¯Ø©</button>
          `;
        } else if(step===2){
          modal.innerHTML += `
            <div class="modal-title">Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·</div>
            <div style="text-align:right;font-size:1rem;margin-bottom:15px;">
              <ul>
                <li>ØªØªØ¹Ù‡Ø¯ Ø¨Ø§Ù„Ø­Ø¶ÙˆØ± Ù„Ù„ÙˆØ¸ÙŠÙØ© ÙÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯.</li>
                <li>Ø±Ø³ÙˆÙ… Ø§Ù„Ø­Ø¬Ø² ØªØ³ØªØ±Ø¯ ÙÙŠ Ø­Ø§Ù„ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¨Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ¹Ø¯.</li>
                <li>Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø±Ø³Ù…ÙŠ ÙˆÙŠØ«Ø¨Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ.</li>
              </ul>
            </div>
            <button class="apply-btn modal-btn" onclick="nextStep()">Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ·</button>
            <button class="apply-btn light" style="margin-top:8px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="prevStep()">Ø¹ÙˆØ¯Ø©</button>
          `;
        } else if(step===3){
          modal.innerHTML += `
            <div class="modal-title">ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
            <div style="font-size:1.09rem;margin-bottom:7px;">ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ Ù„Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯:</div>
            <input type="text" id="sign-input" value="${myUser.name}" style="margin-bottom:11px;">
            <button class="apply-btn modal-btn" onclick="nextStep()">ØªÙˆÙ‚ÙŠØ¹ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©</button>
            <button class="apply-btn light" style="margin-top:8px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="prevStep()">Ø¹ÙˆØ¯Ø©</button>
          `;
        } else if(step===4){
          let signName = document.getElementById('sign-input')?document.getElementById('sign-input').value:myUser.name;
          // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          appId = db.ref("applications").push({
            ...myUser,
            deviceId,
            jobId: job.id,
            jobKey,
            jobTitle: job.title,
            company: job.company,
            province: job.province,
            salary: job.salary,
            hours: job.hours,
            type: job.type,
            signature: signName,
            status: "approved", // Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ø¹Ø±Ø¶
            adminMsg: "",
            paymentStatus: "pending",
            timestamp: new Date().toISOString()
          }).key;
          modal.innerHTML += `
            <div class="modal-title">ØªÙ… ØªÙˆØ¸ÙŠÙÙƒ Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹</div>
            <div class="success">Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ ÙˆØ³ÙŠØªÙ… ØªØ«Ø¨ÙŠØªÙƒ Ø¨Ø¹Ø¯ Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ø­Ø¬Ø².</div>
            <div style="margin:9px 0 4px 0;">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù…ÙŠÙ„ Ø¹Ù‚Ø¯ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù†:</div>
            <button class="download-contract-btn" onclick="generateContractPDF({
              name:'${myUser.name}',phone:'${myUser.phone}',province:'${myUser.province}',
              jobTitle:'${job.title}',company:'${job.company}',salary:'${job.salary}',
              hours:'${job.hours}',type:'${job.type}',signature:'${signName}',timestamp:'${new Date().toISOString()}'
            })">ØªØ­Ù…ÙŠÙ„ Ø¹Ù‚Ø¯ Ø§Ù„Ø¹Ù…Ù„ PDF</button>
            <div class="pay-info">
              <div style="font-weight:700;color:#6900ad;">Ù„Ø¥ØªÙ…Ø§Ù… Ø­Ø¬Ø² Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙŠØ¬Ø¨ Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ø­Ø¬Ø²:</div>
              <span class="amount">32.5 Ø¯ÙŠÙ†Ø§Ø±</span><br>
              <span>ØªØ´Ù…Ù„: Ø±Ø³ÙˆÙ… Ø¥ØµØ¯Ø§Ø± Ø´Ù‡Ø§Ø¯Ø© Ø¹Ø¯Ù… Ù…Ø­ÙƒÙˆÙ…ÙŠØ© ÙÙˆØ±ÙŠØ©ØŒ Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø±Ø³ÙˆÙ… Ø·ÙˆØ§Ø¨Ø¹</span><br>
              <div style="color:#127c01;font-weight:600;margin:7px 0 3px 0;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</div>
              <div>Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙƒÙ„ÙŠÙƒ <b>(Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±: royajobs)</b></div>
              <div class="bank">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠ</div>
              <div style="font-size:.97rem;margin-top:6px;color:#ad6c00;">Ø§Ù„Ù…Ø¨Ù„Øº ÙŠÙØ³ØªØ±Ø¯ ÙÙŠ Ø­Ø§Ù„ Ø£Ø¨Ù„ØºØª Ø¨Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ù‚Ø¨Ù„ Ù…ÙˆØ¹Ø¯ Ø§Ù„ÙˆØ¸ÙŠÙØ©.</div>
              <button class="apply-btn" onclick="confirmPayment('${appId}')">Ù„Ù‚Ø¯ Ø¯ÙØ¹Øª</button>
              <button class="apply-btn light" style="margin-top:8px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="cancelRequest('${appId}')">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
            <button class="apply-btn light" style="margin-top:14px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="closeApplyModal()">Ø¥ØºÙ„Ø§Ù‚</button>
          `;
        }
      }
      window.nextStep = nextStep;
      window.prevStep = prevStep;
      window.cancelRequest = cancelRequest;
      renderStep();
      document.getElementById("apply-modal-bg").style.display="flex";
    }

    window.closeApplyModal = function() {
      document.getElementById("apply-modal-bg").style.display="none";
    }

    // ØªØ­Ù…ÙŠÙ„ Ø¹Ù‚Ø¯ Ø§Ù„Ø¹Ù…Ù„ PDF
    function generateContractPDF(app) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation: "portrait", unit: "mm", format: "a4"});
      doc.setFont("Tajawal", "bold");
      doc.setFontSize(24);
      doc.setTextColor(105, 0, 173);
      doc.text("Ø¹Ù‚Ø¯ Ø¹Ù…Ù„ Ø±Ø³Ù…ÙŠ", 105, 22, { align: "center" });

      doc.setDrawColor(105,0,173);
      doc.setLineWidth(1.2);
      doc.rect(18, 35, 175, 155, "S");

      doc.setFontSize(15);
      doc.setTextColor(40,40,40);
      doc.text(`Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: ${app.name}`, 28, 50);
      doc.text(`Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${app.phone}`, 28, 62);
      doc.text(`Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${app.province}`, 28, 74);
      doc.text(`Ø§Ù„ÙˆØ¸ÙŠÙØ©: ${app.jobTitle}`, 28, 86);
      doc.text(`Ø§Ù„Ø´Ø±ÙƒØ©: ${app.company}`, 28, 98);
      doc.text(`Ø§Ù„Ø±Ø§ØªØ¨: ${app.salary} Ø¯ÙŠÙ†Ø§Ø± Ø£Ø±Ø¯Ù†ÙŠ`, 28, 110);
      doc.text(`Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: ${app.hours||"--"} Ø³Ø§Ø¹Ø©`, 28, 122);
      doc.text(`Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„: ${app.type}`, 28, 134);

      doc.setFontSize(13);
      doc.setTextColor(60,60,60);
      doc.text("Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø¯ ÙŠØ«Ø¨Øª ØªÙˆØ¸ÙŠÙ Ø§Ù„Ù…Ø°ÙƒÙˆØ± Ø£Ø¹Ù„Ø§Ù‡ ÙÙŠ Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø¨Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…ÙˆØ¶Ø­Ø© Ø£Ø¹Ù„Ø§Ù‡.", 28, 146);

      doc.setFontSize(15);
      doc.setTextColor(0,105,40);
      doc.text("ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸Ù:", 28, 160);
      doc.setFontSize(18);
      doc.setTextColor(40,40,40);
      doc.text(`${app.signature||app.name}`, 60, 160);

      doc.setFontSize(13);
      doc.setTextColor(90,90,90);
      doc.text("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: " + (new Date(app.timestamp).toLocaleDateString("ar-EG")), 28, 178);

      doc.setFontSize(18);
      doc.setTextColor(105, 0, 173);
      doc.text("Ù‚Ù†Ø§Ø© Ø±Ø¤ÙŠØ§", 150, 160);
      doc.setFontSize(14);
      doc.setTextColor(0,0,0);
      doc.text("ØªÙˆÙ‚ÙŠØ¹ ÙˆØ®ØªÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©", 150, 170);

      doc.setFontSize(11);
      doc.setTextColor(180,0,50);
      doc.text("Ø¹Ù‚Ø¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø±Ø³Ù…ÙŠ â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ø±Ø¤ÙŠØ§ 2025", 105, 200, {align:"center"});

      doc.save(`Ø¹Ù‚Ø¯_Ø¹Ù…Ù„_${app.name}.pdf`);
    }

    // Ø²Ø± Ø¯ÙØ¹
    window.confirmPayment = function(appId){
      db.ref("applications/"+appId).update({paymentStatus:"checking"});
      window.showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹ÙƒØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.");
      closeApplyModal();
      // Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙŠØ¸Ù‡Ø± Ù„Ù‡ "Ø§Ù„Ø¯ÙØ¹ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚Ù‚"
    }
    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
    window.cancelRequest = function(appId){
      db.ref("applications/"+appId).remove();
      window.showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ù„ÙˆØ¸ÙŠÙØ© Ø£Ø®Ø±Ù‰.");
      closeApplyModal();
      loadJobs();
    }

    // Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ø§ØªÙŠ (Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯ ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©)
    window.showRequests = function(){
      let user = myUser;
      const modal = document.getElementById("req-modal");
      db.ref("applications").orderByChild("deviceId").equalTo(deviceId).once("value",snap=>{
        const apps = snap.exists()?Object.entries(snap.val()).map(([key,a])=>({...a, key})):[];
        let html = `<div class="modal-title">Ø·Ù„Ø¨Ø§ØªÙŠ</div>`;
        if(apps.length==0) html+=`<div>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</div>`;
        else apps.reverse().forEach(a=>{
          html += `<div style="border-bottom:1px solid #eee;margin-bottom:8px;padding-bottom:5px;">
            <b>${a.jobTitle}</b> - <span style="color:#6900ad;">${a.status=="pending"?"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©":a.status=="approved"?"ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©":"Ù…Ø±ÙÙˆØ¶"}</span>
            <div class="req-status ${a.status}">${a.status=="pending"?"Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù…Ù† Ø§Ù„Ù…Ø´Ø±Ù":a.status=="approved"?"ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ!":"ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨"}</div>
            <div>Ø§Ù„Ø´Ø±ÙƒØ©: ${a.company||"--"} | Ø§Ù„Ø±Ø§ØªØ¨: ${a.salary||"--"} | Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${a.province||"--"}</div>
            <div>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…: ${a.timestamp?new Date(a.timestamp).toLocaleString("ar-EG"):"--"}</div>
            ${a.status=="approved"?`
              <div class="pay-info">
                <div style="font-weight:700;color:#6900ad;">Ù„Ø¥ØªÙ…Ø§Ù… Ø­Ø¬Ø² Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙŠØ¬Ø¨ Ø¯ÙØ¹ Ø±Ø³ÙˆÙ… Ø§Ù„Ø­Ø¬Ø²:</div>
                <span class="amount">32.5 Ø¯ÙŠÙ†Ø§Ø±</span><br>
                <span>ØªØ´Ù…Ù„: Ø±Ø³ÙˆÙ… Ø¥ØµØ¯Ø§Ø± Ø´Ù‡Ø§Ø¯Ø© Ø¹Ø¯Ù… Ù…Ø­ÙƒÙˆÙ…ÙŠØ© ÙÙˆØ±ÙŠØ©ØŒ Ø¶Ø±ÙŠØ¨Ø©ØŒ Ø±Ø³ÙˆÙ… Ø·ÙˆØ§Ø¨Ø¹</span><br>
                <div style="color:#127c01;font-weight:600;margin:7px 0 3px 0;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</div>
                <div>Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙƒÙ„ÙŠÙƒ <b>(Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±: royajobs)</b></div>
                <div class="bank">Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø£Ù‡Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠ</div>
                <div style="font-size:.97rem;margin-top:6px;color:#ad6c00;">Ø§Ù„Ù…Ø¨Ù„Øº ÙŠÙØ³ØªØ±Ø¯ ÙÙŠ Ø­Ø§Ù„ Ø£Ø¨Ù„ØºØª Ø¨Ø¹Ø¯Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ù‚Ø¨Ù„ Ù…ÙˆØ¹Ø¯ Ø§Ù„ÙˆØ¸ÙŠÙØ©.</div>
                ${a.paymentStatus=="pending"?`
                  <button class="apply-btn" onclick="confirmPayment('${a.key}')">Ù„Ù‚Ø¯ Ø¯ÙØ¹Øª</button>
                  <button class="apply-btn light" style="margin-top:8px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="cancelRequest('${a.key}')">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
                `:""}
                ${a.paymentStatus=="checking"?`
                  <span class="pending">Ø§Ù„Ø¯ÙØ¹ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
                  <button class="apply-btn light" style="margin-top:8px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="cancelRequest('${a.key}')">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
                `:""}
                ${a.paymentStatus=="done"?`<span class="success">ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨Ù†Ø¬Ø§Ø­!</span>`:""}
                <button class="download-contract-btn" style="margin-top:12px;" onclick='generateContractPDF(${JSON.stringify(a)})'>ØªØ­Ù…ÙŠÙ„ Ø¹Ù‚Ø¯ Ø§Ù„Ø¹Ù…Ù„ PDF</button>
              </div>
            `:""}
            ${a.status=="rejected" && a.adminMsg?`<div class="rejected">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶: ${a.adminMsg}</div>`:""}
          </div>`;
        });
        html += `<button class="apply-btn light" style="margin-top:14px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="closeReqModal()">Ø¥ØºÙ„Ø§Ù‚</button>`;
        modal.innerHTML = html;
        document.getElementById("req-modal-bg").style.display="flex";
      });
    }
    window.closeReqModal = function() {
      document.getElementById("req-modal-bg").style.display="none";
    }
    document.getElementById("req-modal-bg").onclick = function(e){ if(e.target===this) closeReqModal();}
    document.getElementById("apply-modal-bg").onclick = function(e){ if(e.target===this) closeApplyModal();}
  </script>
</body>
</html>