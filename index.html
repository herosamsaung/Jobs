<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>موقع الوظائف الأردني</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, get } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyCtvxXiWWZ4GxWxz1rAhu9nRwiFlkiKMtA",
      authDomain: "royanew-a02f3.firebaseapp.com",
      projectId: "royanew-a02f3",
      storageBucket: "royanew-a02f3.firebasestorage.app",
      messagingSenderId: "640968299159",
      appId: "1:640968299159:web:590e4256ad1492ca19cfd2",
      measurementId: "G-69TLG6LYYK",
      databaseURL: "https://royanew-a02f3-default-rtdb.firebaseio.com"
    };
    window.app = initializeApp(firebaseConfig);
    window.db = getDatabase(app);
    window.ref = ref;
    window.set = set;
    window.push = push;
    window.onValue = onValue;
    window.get = get;
  </script>
  <!-- html2canvas for contract image -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: "Cairo", Arial, sans-serif;
      background: linear-gradient(135deg, #f4f6f8 60%, #e4f1fb 100%);
      margin: 0;
      color: #222;
    }
    .logo {
      display:block;
      margin: 30px auto 10px auto;
      width: 130px;
      border-radius: 16px;
      box-shadow: 0 2px 12px #aaa;
      background: #fff;
      padding: 10px;
    }
    .main-box {
      max-width: 420px;
      margin: 25px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 12px #b0d4ed;
      padding: 28px 24px 18px 24px;
      text-align: right;
    }
    h1 {
      text-align: center;
      color: #2196f3;
      margin-top: 0;
    }
    label {
      display: block;
      margin: 12px 0 3px 0;
      font-weight: bold;
    }
    input, select {
      width: 98%;
      padding: 8px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #b0d4ed;
      margin-bottom: 10px;
      box-sizing: border-box;
      direction: rtl;
    }
    button {
      background: #2196f3;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 22px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s;
      box-shadow: 0 1px 6px #b0d4ed;
    }
    button:hover { background: #1565c0; }
    .jobs-box {
      margin-top: 22px;
      border-radius: 12px;
      background: #f7fbff;
      padding: 10px;
      box-shadow: 0 1px 6px #b0d4ed;
      min-height: 120px;
    }
    .job-item {
      padding: 11px 7px;
      border-bottom: 1px solid #dfe8f3;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .job-item:last-child { border-bottom: none; }
    .job-title {
      color: #1976d2;
      font-weight: bold;
      font-size: 1.15rem;
    }
    .job-info { font-size: 0.97rem; color: #444; }
    .select-job-btn {
      align-self: flex-end;
      background: #43a047;
      margin: 0;
      padding: 7px 18px;
      font-size: 0.95rem;
    }
    .select-job-btn:hover { background: #2e7031; }
    #contractModal {
      position: fixed; top:0; left:0; width:100vw; height:100vh;
      background: rgba(30,60,100,0.19);
      display:none; align-items: center; justify-content: center; z-index:99;
    }
    #contractView {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 24px #b0d4ed;
      padding: 24px 22px;
      max-width: 500px;
      width: 95vw;
      text-align: center;
      position: relative;
    }
    #contractImage {
      width: 100%; border-radius: 12px; margin-top: 10px;
      box-shadow: 0 1px 6px #b0d4ed;
    }
    .closeModal {
      position: absolute; left:20px; top:14px; font-size:1.5rem; background:none; border:none; color:#2196f3; cursor:pointer;
    }
    @media (max-width: 600px) {
      .main-box { padding: 13px 2vw; }
      .jobs-box { padding: 4px; }
      #contractView { padding: 13px 2vw; }
    }
  </style>
</head>
<body>
  <img src="https://www2.0zz0.com/2025/10/15/20/337819623.png" class="logo" alt="شعار الموقع" />
  <div class="main-box" id="mainBox">
    <h1>منصة الوظائف الأردنية</h1>
    <form id="regForm">
      <label>الاسم الكامل</label>
      <input type="text" id="userName" maxlength="40" required autocomplete="name" />
      <label>رقم الهاتف</label>
      <input type="tel" id="userPhone" maxlength="13" required autocomplete="tel" pattern="^07[7-9][0-9]{7}$" placeholder="07xxxxxxxx" />
      <label>المحافظة</label>
      <select id="userGov" required>
        <option value="">اختر المحافظة</option>
        <option value="عمان">عمان</option>
        <option value="إربد">إربد</option>
        <option value="الزرقاء">الزرقاء</option>
        <option value="البلقاء">البلقاء</option>
        <option value="المفرق">المفرق</option>
        <option value="جرش">جرش</option>
        <option value="عجلون">عجلون</option>
        <option value="مأدبا">مأدبا</option>
        <option value="الكرك">الكرك</option>
        <option value="الطفيلة">الطفيلة</option>
        <option value="معان">معان</option>
        <option value="العقبة">العقبة</option>
      </select>
      <button type="submit">دخول المنصة</button>
    </form>
    <div class="jobs-box" id="jobsBox" style="display:none"></div>
  </div>
  <!-- عقد الوظيفة -->
  <div id="contractModal">
    <div id="contractView">
      <button class="closeModal" onclick="hideContractModal()">✖</button>
      <div id="contractContainer"></div>
      <img id="contractImage" style="display:none" />
      <button onclick="downloadContractImage()" id="downloadBtn" style="margin-top:8px;display:none">تحميل صورة العقد</button>
    </div>
  </div>
  <script>
    // متغيرات المستخدم
    let currentUser = null, userKey = null, selectedJob = null, jobsList = [];
    // إخفاء عرض الوظائف حتى التسجيل
    const regForm = document.getElementById('regForm');
    const jobsBox = document.getElementById('jobsBox');
    regForm.addEventListener('submit', async function(e){
      e.preventDefault();
      // تحقق من صحة البيانات
      let name = document.getElementById('userName').value.trim();
      let phone = document.getElementById('userPhone').value.trim();
      let gov = document.getElementById('userGov').value;
      if(!name || !phone || !gov) return alert("يرجى تعبئة جميع الحقول");
      if(!/^07[7-9][0-9]{7}$/.test(phone)) return alert("رقم الهاتف الأردني غير صحيح");
      // حفظ المستخدم في قاعدة البيانات
      userKey = (await window.push(window.ref(window.db, 'users/'), {
        name, phone, gov, regTime: Date.now()
      })).key;
      currentUser = { name, phone, gov, key: userKey };
      regForm.style.display = 'none';
      jobsBox.style.display = 'block';
      loadJobs(gov);
    });
    // جلب الوظائف الجاهزة من قاعدة البيانات
    async function loadJobs(userGov){
      let snap = await window.get(window.ref(window.db, 'jobs/'));
      let jobs = snap.exists() ? Object.values(snap.val()) : [];
      jobsList = jobs.filter(j=>j.gov === userGov);
      if(jobsList.length === 0) jobsBox.innerHTML = "<div style='text-align:center;color:#a00;padding:18px'>لا توجد وظائف متاحة في المحافظة المختارة حالياً</div>";
      else renderJobs();
    }
    function renderJobs(){
      jobsBox.innerHTML = "";
      jobsList.forEach((job,idx)=>{
        let jobDiv = document.createElement('div');
        jobDiv.className = "job-item";
        jobDiv.innerHTML = `
          <span class="job-title">${job.title}</span>
          <span class="job-info">عدد الساعات: <b>${job.hours}</b> | الراتب: <b>${job.salary}</b> دينار</span>
          <span class="job-info">المحافظة: ${job.gov}</span>
          <button class="select-job-btn" onclick="selectJob(${idx})">اختيار الوظيفة</button>
        `;
        jobsBox.appendChild(jobDiv);
      });
    }
    window.selectJob = function(idx){
      selectedJob = jobsList[idx];
      // إنشاء عقد وتخزينه
      let contractData = {
        userName: currentUser.name,
        userPhone: currentUser.phone,
        userGov: currentUser.gov,
        jobTitle: selectedJob.title,
        jobHours: selectedJob.hours,
        jobSalary: selectedJob.salary,
        jobGov: selectedJob.gov,
        contractTime: Date.now()
      };
      window.push(window.ref(window.db, 'contracts/'), contractData);
      showContract(contractData);
    }
    // عرض العقد كصورة
    function showContract(contract){
      const contractHtml = `
        <div id="contractDesign" style="font-family: 'Cairo'; direction:rtl; background:#fff; border-radius:18px; padding:22px 18px; box-shadow:0 1px 6px #b0d4ed; max-width:430px; margin:auto; border:1px solid #b0d4ed;">
          <div style="text-align:center;">
            <img src="https://www2.0zz0.com/2025/10/15/20/337819623.png" style="width:80px; border-radius:10px; margin-bottom:10px" alt="شعار الموقع" />
            <h2 style="margin:0;color:#2196f3;font-size:1.5rem">عقد توظيف رسمي</h2>
            <div style="color:#888; font-size:0.99rem;margin-bottom:8px">رقم العقد: <b>${Math.floor(Math.random()*90000+10000)}</b></div>
          </div>
          <div style="margin:12px 0 5px 0; font-size:1.06rem">
            <b>الطرف الأول (الموقع):</b> منصة الوظائف الأردنية<br>
            <b>الطرف الثاني (الموظف):</b> ${contract.userName} <br>
            <b>رقم الهاتف:</b> ${contract.userPhone}<br>
            <b>المحافظة:</b> ${contract.userGov}
          </div>
          <div style="margin:9px 0 5px 0; font-size:1.08rem">
            يقر الطرفان بإبرام هذا العقد على وظيفة: <b>${contract.jobTitle}</b> في محافظة <b>${contract.jobGov}</b>، بمدة عمل <b>${contract.jobHours}</b> ساعات يومياً، براتب شهري <b>${contract.jobSalary}</b> دينار أردني.
          </div>
          <div style="margin:8px 0 7px 0; color:#333; font-size:0.97rem">
            تم توقيع العقد إلكترونيًا بتاريخ: <b>${new Date(contract.contractTime).toLocaleDateString('ar-JO')}</b>
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:18px">
            <div style="text-align:center">
              <div style="font-size:0.95rem;color:#555;font-weight:bold">توقيع الموقع</div>
              <img src="https://www2.0zz0.com/2025/10/15/20/337819623.png" style="width:55px;opacity:0.7" alt="ختم الموقع" />
            </div>
            <div style="text-align:center">
              <div style="font-size:0.95rem;color:#555;font-weight:bold">توقيع الموظف</div>
              <div style="border-bottom:2px solid #2196f3; width:80px; height:22px; margin:auto; font-style:italic; font-family:'Cairo'; color:#1976d2; font-size:0.98rem">${contract.userName}</div>
            </div>
          </div>
          <div style="text-align:center; margin-top:15px; color:#bbb; font-size:0.9rem">
            جميع الحقوق محفوظة &copy; منصة الوظائف الأردنية 2025
          </div>
        </div>
      `;
      document.getElementById("contractContainer").innerHTML = contractHtml;
      document.getElementById("contractModal").style.display = 'flex';
      setTimeout(()=>{
        html2canvas(document.getElementById("contractDesign")).then(canvas=>{
          document.getElementById("contractImage").src = canvas.toDataURL("image/png");
          document.getElementById("contractImage").style.display = "block";
          document.getElementById("downloadBtn").style.display = "inline-block";
        });
      }, 350);
    }
    // إغلاق العقد
    window.hideContractModal = function(){
      document.getElementById("contractModal").style.display = 'none';
      document.getElementById("contractImage").style.display = "none";
      document.getElementById("downloadBtn").style.display = "none";
      document.getElementById("contractContainer").innerHTML = "";
    }
    // تحميل صورة العقد
    window.downloadContractImage = function(){
      let img = document.getElementById("contractImage");
      let link = document.createElement('a');
      link.href = img.src;
      link.download = "employment_contract.png";
      link.click();
    }
  </script>
</body>
</html>