<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة تحكم المشرف | وظائف رؤيا</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Tajawal:400,700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Tajawal', Arial, sans-serif; background: #f4f4fa; color: #222; margin:0; padding:0; }
    .container { max-width: 900px; margin: 30px auto; background: #fff; border-radius: 18px; box-shadow: 0 2px 22px #a97be73f; padding: 24px; }
    h1 { color: #6900ad; text-align: center; }
    label { font-size:1.08rem;margin-bottom:3px;display:block;}
    input, textarea, select {
      width: 99%; padding: 8px; margin-bottom: 11px; border-radius: 8px; border: 1.3px solid #cbb7eb;
      font-size: 1.08rem; background: #f7f2ff;
    }
    button {
      background:#6900ad;color:#fff;font-size:1.02rem; border:none; border-radius:7px; padding:9px 18px; cursor:pointer;
      transition:background 0.15s;
      margin-right:8px;
    }
    button.danger {background:#b30000;}
    .job-list {margin-top:25px;}
    .job-card {
      background:#f9f7fd;border:1px solid #e7e0f7;border-radius:11px;padding:15px;margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;
      transition:box-shadow 0.15s;
    }
    .job-card:hover { box-shadow:0 2px 10px #6900ad1a; }
    .job-info {flex:1;}
    .company-logo {width:50px;height:50px;object-fit:cover;border-radius:8px;margin-left:12px;}
    @media (max-width: 700px) {
      .container { padding: 6px; }
      .job-card { flex-direction:column;align-items:flex-start;}
      .company-logo {margin-left:0;margin-bottom:9px;}
    }
    .login-box {
      max-width:340px;margin:70px auto;padding:32px;border-radius:18px;background:#fff;box-shadow:0 1px 8px #6900ad12;text-align:center;
    }
    .login-box input {margin-bottom:15px;}
  </style>
  <script type="module">
    // ========== auth ===========
    let loggedIn = false;
    function showLogin() {
      document.getElementById("login").style.display = "block";
      document.getElementById("panel").style.display = "none";
    }
    function showPanel() {
      document.getElementById("login").style.display = "none";
      document.getElementById("panel").style.display = "block";
      fetchJobs();
    }
    window.checkLogin = function() {
      const user = document.getElementById("admin-user").value;
      const pass = document.getElementById("admin-pass").value;
      if(user==="Hero" && pass==="Hero@123") {
        loggedIn = true;
        showPanel();
      } else {
        alert("بيانات الدخول غير صحيحة!");
      }
    }
    // ========== firebase =========
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getDatabase, ref, push, set, remove, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyBr03bRk3uNzLCFzr53ufdPbA3DrOZHxWQ",
      authDomain: "jobsroya.firebaseapp.com",
      projectId: "jobsroya",
      storageBucket: "jobsroya.firebasestorage.app",
      messagingSenderId: "882520191513",
      appId: "1:882520191513:web:2165131b20e33bdc38b088",
      measurementId: "G-RW67K10VPD",
      databaseURL: "https://jobsroya-default-rtdb.firebaseio.com"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ========== وظائف ===========
    let jobsArr = [];
    let jobsKeys = [];
    function fetchJobs() {
      onValue(ref(db, "jobs"), snap=>{
        jobsArr = []; jobsKeys = [];
        if(snap.val()) {
          Object.entries(snap.val()).forEach(([k,v])=>{
            jobsArr.push(v); jobsKeys.push(k);
          });
        }
        renderJobs();
      });
    }
    // ========== إضافة ===========
    window.addJob = function() {
      const job = {
        title: document.getElementById("job-title").value,
        company: document.getElementById("job-company").value,
        salary: parseInt(document.getElementById("job-salary").value),
        hours: parseInt(document.getElementById("job-hours").value),
        province: document.getElementById("job-province").value,
        type: document.getElementById("job-type").value,
        exp: document.getElementById("job-exp").value,
        desc: document.getElementById("job-desc").value,
        logo: document.getElementById("job-logo").value
      };
      if(!job.title || !job.company || !job.salary || !job.hours || !job.province) {
        alert("يرجى تعبئة جميع البيانات الأساسية");
        return;
      }
      push(ref(db,"jobs"), job);
      document.getElementById("job-form").reset();
    }
    // ========== حذف ===========
    window.deleteJob = function(idx) {
      if(!confirm("هل تريد حذف هذه الوظيفة؟")) return;
      remove(ref(db,"jobs/"+jobsKeys[idx]));
    }
    // ========== تعديل ===========
    window.editJob = function(idx) {
      const job = jobsArr[idx];
      document.getElementById("job-title").value = job.title;
      document.getElementById("job-company").value = job.company;
      document.getElementById("job-salary").value = job.salary;
      document.getElementById("job-hours").value = job.hours;
      document.getElementById("job-province").value = job.province;
      document.getElementById("job-type").value = job.type||"";
      document.getElementById("job-exp").value = job.exp||"";
      document.getElementById("job-desc").value = job.desc||"";
      document.getElementById("job-logo").value = job.logo||"";
      window.currentEdit = idx;
      document.getElementById("add-btn").style.display = "none";
      document.getElementById("save-btn").style.display = "inline-block";
      document.getElementById("cancel-btn").style.display = "inline-block";
    }
    window.saveEdit = function() {
      const idx = window.currentEdit;
      const job = {
        title: document.getElementById("job-title").value,
        company: document.getElementById("job-company").value,
        salary: parseInt(document.getElementById("job-salary").value),
        hours: parseInt(document.getElementById("job-hours").value),
        province: document.getElementById("job-province").value,
        type: document.getElementById("job-type").value,
        exp: document.getElementById("job-exp").value,
        desc: document.getElementById("job-desc").value,
        logo: document.getElementById("job-logo").value
      };
      set(ref(db,"jobs/"+jobsKeys[idx]), job);
      document.getElementById("job-form").reset();
      document.getElementById("add-btn").style.display = "inline-block";
      document.getElementById("save-btn").style.display = "none";
      document.getElementById("cancel-btn").style.display = "none";
      window.currentEdit = null;
    }
    window.cancelEdit = function() {
      document.getElementById("job-form").reset();
      document.getElementById("add-btn").style.display = "inline-block";
      document.getElementById("save-btn").style.display = "none";
      document.getElementById("cancel-btn").style.display = "none";
      window.currentEdit = null;
    }
    // ========== رسم ===========
    function renderJobs() {
      const list = document.getElementById("jobs-list");
      list.innerHTML = "";
      if(!jobsArr.length) {
        list.innerHTML = "<div style='text-align:center;padding:30px;font-size:1.2rem;color:#6900ad'>لا يوجد وظائف بعد.</div>";
        return;
      }
      jobsArr.forEach((job, idx) => {
        list.innerHTML += `
        <div class="job-card">
          <img class="company-logo" src="${job.logo||'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}" alt="شعار الشركة"/>
          <div class="job-info">
            <div><b>${job.title}</b> (${job.company})</div>
            <div>المحافظة: <b>${job.province}</b> | الراتب: <b>${job.salary}</b> | الساعات: <b>${job.hours}</b></div>
            <div>النوع: <b>${job.type||"--"}</b> | الخبرة: <b>${job.exp||"--"}</b></div>
            <div style="font-size:.97rem;">${job.desc||"--"}</div>
          </div>
          <div>
            <button onclick="editJob(${idx})">تعديل</button>
            <button class="danger" onclick="deleteJob(${idx})">حذف</button>
          </div>
        </div>`;
      });
    }
    window.onload = showLogin;
  </script>
</head>
<body>
  <div id="login" class="login-box">
    <h2>دخول المشرف</h2>
    <input id="admin-user" type="text" placeholder="اسم المستخدم" required />
    <input id="admin-pass" type="password" placeholder="كلمة المرور" required />
    <button onclick="checkLogin()">دخول</button>
  </div>
  <div id="panel" style="display:none;">
    <div class="container">
      <h1>لوحة تحكم المشرف</h1>
      <form id="job-form" onsubmit="return false;">
        <label>اسم الوظيفة:</label>
        <input id="job-title" required>
        <label>اسم الشركة:</label>
        <input id="job-company" required>
        <label>الراتب:</label>
        <input id="job-salary" type="number" required>
        <label>عدد الساعات:</label>
        <input id="job-hours" type="number" required>
        <label>المحافظة:</label>
        <input id="job-province" required>
        <label>نوع الدوام:</label>
        <input id="job-type" placeholder="مثال: دوام كامل / جزئي / عن بعد">
        <label>الخبرة المطلوبة:</label>
        <input id="job-exp" placeholder="مثال: بدون خبرة / 1-3 سنوات / 3+ سنوات">
        <label>رابط شعار الشركة:</label>
        <input id="job-logo" placeholder="رابط صورة (اختياري)">
        <label>وصف الوظيفة:</label>
        <textarea id="job-desc" style="height:55px;"></textarea>
        <button id="add-btn" onclick="addJob()">إضافة وظيفة</button>
        <button id="save-btn" onclick="saveEdit()" style="display:none;">حفظ التعديل</button>
        <button id="cancel-btn" onclick="cancelEdit()" style="display:none;">إلغاء</button>
      </form>
      <div class="job-list" id="jobs-list"></div>
    </div>
  </div>
</body>
</html>